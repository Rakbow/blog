<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${album.name}"></title>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>

    <!-- bootstrap -->
    <link rel="stylesheet" th:href="@{/css/bootstrap/myBootstrap.min.css}">
    <script th:src="@{/tool/bootstrap/bootstrap.min.js}"></script>

    <!-- marked -->
    <link th:href="@{/css/github-markdown/github-markdown.css}" rel="stylesheet"/>

    <link href="https://img.rakbow.com/common/logo/favicon.ico" type="image/x-icon" rel="shortcut icon"/>
    <link th:href="@{/css/iconfont/iconfont.css}" rel="stylesheet"/>

    <!-- PrimeVue -->
    <link th:href="@{/css/primevue/bootstrap4-dark-blue.css}" rel="stylesheet"/>
    <link th:href="@{/css/primevue/primevue.min.css}" rel="stylesheet"/>
    <link th:href="@{/css/primevue/primeflex.min.css}" rel="stylesheet"/>
    <link th:href="@{/css/primevue/primeicon/primeicons.css}" rel="stylesheet"/>

    <!-- Vue3 -->
    <script th:src="@{/js/vue/vue.global.min.js}"></script>
    <script th:src="@{/js/primevue/core.min.js}"></script>
    <script th:src="@{/js/vue/vue-router.global.min.js}"></script>

    <!-- PrimeVue Components -->
    <script th:src="@{/js/primevue/components/fileupload.min.js}"></script>
    <script th:src="@{/js/primevue/components/panel.min.js}"></script>
    <script th:src="@{/js/primevue/components/divider.min.js}"></script>
    <script th:src="@{/js/primevue/components/dialog.min.js}"></script>
    <script th:src="@{/js/primevue/components/fieldset.min.js}"></script>
    <script th:src="@{/js/primevue/components/chips.min.js}"></script>
    <script th:src="@{/js/primevue/components/inputtext.min.js}"></script>
    <script th:src="@{/js/primevue/components/multiselect.min.js}"></script>
    <script th:src="@{/js/primevue/components/galleria.min.js}"></script>
    <script th:src="@{/js/primevue/components/menubar.min.js}"></script>
    <script th:src="@{/js/primevue/components/avatar.min.js}"></script>
    <script th:src="@{/js/primevue/components/toast.min.js}"></script>
    <script th:src="@{/js/primevue/components/toastservice.min.js}"></script>
    <script th:src="@{/js/primevue/components/textarea.min.js}"></script>
    <script th:src="@{/js/primevue/components/calendar.min.js}"></script>
    <script th:src="@{/js/primevue/components/inputnumber.min.js}"></script>
    <script th:src="@{/js/primevue/components/inputswitch.min.js}"></script>
    <script th:src="@{/js/primevue/components/splitbutton.min.js}"></script>
    <script th:src="@{/js/primevue/components/datatable.min.js}"></script>
    <script th:src="@{/js/primevue/components/column.min.js}"></script>
    <script th:src="@{/js/primevue/components/contextmenu.min.js}"></script>
    <script th:src="@{/js/primevue/components/inplace.min.js}"></script>
    <script th:src="@{/js/primevue/components/blockui.min.js}"></script>
    <script th:src="@{/js/primevue/components/tag.min.js}"></script>
    <script th:src="@{/js/primevue/components/card.min.js}"></script>
    <script th:src="@{/js/primevue/components/checkbox.min.js}"></script>

    <script th:src="@{/js/primevue/components/scrolltop.min.js}"></script>
    <script th:src="@{/js/primevue/components/scrollpanel.min.js}"></script>
    <script th:src="@{/js/primevue/components/dynamicdialog.min.js}"></script>
    <script th:src="@{/js/primevue/components/dialogservice.min.js}"></script>
    <script th:src="@{/js/primevue/components/chip.min.js}"></script>
    <script th:src="@{/js/primevue/components/skeleton.min.js}"></script>

    <!-- Jquery -->
    <script th:src="@{/js/jquery.js}"></script>

    <!-- color-thief -->
    <script th:src="@{/js/color-thief.min.js}"></script>

    <!-- high light js -->
    <link th:href="@{/tool/highlight/default.min.css}" rel="stylesheet">
    <script th:src="@{/tool/highlight/highlight.min.js}"></script>

    <!-- aplayer -->
    <link th:href="@{/tool/aplayer/APlayer.min.css}" rel="stylesheet">
    <script th:src="@{/tool/aplayer/APlayer.min.js}"></script>

    <!-- md-editor-v3 -->
    <script th:src="@{/tool/md-editor-v3/md-editor-v3.umd.js}"></script>
    <link th:href="@{/tool/md-editor-v3/style.min.css}" rel="stylesheet">

    <!-- tingle -->
    <script th:src="@{/tool/tingle/tingle.min.js}"></script>
    <link th:href="@{/tool/tingle/tingle.min.css}" rel="stylesheet">

    <!-- flag-icons -->
    <link th:href="@{/css/flag-icons/css/flag-icons.css}" rel="stylesheet">

    <!-- basic js -->
    <script th:src="@{/js/basic/Data_Helper.js}"></script>
    <script th:src="@{/js/basic/Rakbow_Web_Url_Helper_Str.js}"></script>
    <script th:src="@{/js/basic/Rakbow_Web_Exception_Str_CN.js}"></script>

    <!--other css -->
    <link th:href="@{/css/global.css}" rel="stylesheet"/>
    <link th:href="@{/css/search.css}" rel="stylesheet"/>
    <link th:href="@{/css/item-detail.css}" rel="stylesheet"/>
    <link th:href="@{/css/topbar.css}" rel="stylesheet"/>


</head>
<body>
<div id="app" style="margin-top: 60px">
    <!-- header -->
    <header class="sticky-top mb-2" th:insert="~{template/header :: site_header}"></header>

    <div id="main" class="grid mt-2">
        <p-toast></p-toast>
        <div class="detail-card col-8 lg:col-offset-1">
            <p-card>
                <template #title>
                    <div class="grid detail-item-header-title">
                        <h4 class="col-11">
                            <b class="detail-item-title">
                                {{album.name}}
                            </b>
                        </h4>
                        <div th:insert="~{template/item-detail-template :: item_common_edit_button}"></div>
                    </div>
                </template>
                <template #subtitle>
                    <h5 v-if="album.nameEn != ''" class="detail-item-subtitle"><small>{{album.nameEn}}</small></h5>
                    <h5 v-else><small></small></h5>
                    <h5 v-if="album.nameZh != ''" class="detail-item-subtitle"><small>{{album.nameZh}}</small></h5>
                    <h5 v-else><small></small></h5>
                </template>
                <template #content>
                    <div class="grid">
                        <div class="col-4" style="width: 260px">
                            <div class="album-detail-cover">
                                <img :src="itemImageInfo.cover.url" :alt="itemImageInfo.cover.name"/>
                            </div>
                        </div>
                        <div class="col detail-item-header-card">
                            <p-card>
                                <template #content>
                                    <div class="relative">
                                        <table class="table-borderless table-sm ml-2">
                                            <tbody class="detail-item-header-table">
                                            <tr>
                                                <td>
                                                    <i class="pi iconfont icon-dingdanbianhao"></i>
                                                    <strong>{{RKW_Web.AlbumCatalogNo}}</strong>
                                                </td>
                                                <td>
                                                    {{album.catalogNo?album.catalogNo:"N/A"}}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <i class="pi iconfont icon-bar-code"></i>
                                                    <strong>{{RKW_Web.Barcode}}</strong>
                                                </td>
                                                <td>{{album.barcode?album.barcode:"N/A"}}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <i class="pi pi-calendar"></i>
                                                    <strong>{{RKW_Web.ReleaseDate}}</strong>
                                                </td>
                                                <td>
                                                    {{album.releaseDate?album.releaseDate:"N/A"}}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <i class="pi iconfont icon-wuliaojiage"></i>
                                                    <strong>{{RKW_Web.ReleasePrice}}</strong>
                                                </td>
                                                <td>
                                                    {{album.price != 0 ? album.price :"-"}}<span
                                                        v-if="album.currencyUnit == 'JPY'" class="ml-1"
                                                        style="text-decoration-line: underline;text-decoration-style: dashed;"
                                                        v-tooltip.right="{value: RKW_Web.TaxInclusive, class: 'region-tooltip'}">JPY</span><span
                                                        v-else>{{album.currencyUnit}}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <i class="pi iconfont icon-gift"></i>
                                                    <strong>{{RKW_Web.Bonus}}</strong>
                                                </td>
                                                <td>
                                                    <a v-if="album.hasBonus" href="#bonus" class="ml-3">
                                                        <i class="pi true-icon pi-check-circle"></i>
                                                    </a>
                                                    <i v-else class="pi false-icon pi-times-circle"></i>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <i class="pi pi-print"></i>
                                                    <strong>{{RKW_Web.PublishFormat}}</strong>
                                                </td>
                                                <td v-for="format of album.publishFormat" style="display:inline">
                                                    <a :href="'/db/albums?publishFormat=' + format.value">
                                                        <p-tag class="ml-1" :value="format.label"></p-tag>
                                                    </a>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <i class="pi iconfont icon-zhuanjiguangpan"></i>
                                                    <strong>{{RKW_Web.MediaFormat}}</strong>
                                                </td>
                                                <td v-for="format of album.mediaFormat" style="display:inline">
                                                    <a :href="'/db/albums?mediaFormat=' + format.value">
                                                        <p-tag class="ml-1" :value="format.label"></p-tag>
                                                    </a>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <i class="pi iconfont icon-musicfill"></i>
                                                    <strong>{{RKW_Web.AlbumFormat}}</strong>
                                                </td>
                                                <td v-for="format of album.albumFormat" style="display:inline">
                                                    <a :href="'/db/albums?albumFormat=' + format.value">
                                                        <p-tag class="ml-1" :value="format.label"></p-tag>
                                                    </a>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <i class="pi iconfont icon-tushuyinxiang"></i>
                                                    <strong>{{RKW_Web.AlbumLabel}}</strong>
                                                </td>
                                                <td>{{album.label?album.label:"N/A"}}</td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <i class="pi iconfont icon-gongsi"></i>
                                                    <strong>{{RKW_Web.AlbumPublisher}}</strong>
                                                </td>
                                                <td>
                                                    {{album.publisher?album.publisher:"N/A"}}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <i class="pi iconfont icon-company"></i>
                                                    <strong>{{RKW_Web.Distributor}}</strong>
                                                </td>
                                                <td>
                                                    {{album.distributor?album.distributor:"N/A"}}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <i class="pi iconfont icon-copyright"></i>
                                                    <strong>{{RKW_Web.Copyright}}</strong>
                                                </td>
                                                <td>
                                                    {{album.copyright?album.copyright:"N/A"}}
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                        <div th:insert="~{template/item-detail-template :: item_status_edit}" th:if="${loginUser != null}"></div>
                                        <div th:insert="~{template/item-detail-template :: item_statistic_info}"></div>
                                    </div>
                                </template>
                            </p-card>
                        </div>
                    </div>
                    <div class="detail-item-field">
                        <!-- audio player -->
                        <p-fieldset :toggleable="true">
                            <template #legend>
                                <i class="pi iconfont icon-music"></i>
                                <b>{{RKW_Web.ItemDetailPlayListTitle}}</b>
                            </template>
                            <p-button v-if="audioInfos!=null" @click="playerOption.fixed=true, createAplayer()"
                                      class="mr-2"
                                      v-tooltip.bottom="RKW_Web.TooltipMusicPlayerChangeBottom">
                                <i class="pi pi-arrow-circle-down"></i>
                            </p-button>
                            <div id="aplayer"></div>
                        </p-fieldset>
                        <!-- artists -->
                        <p-fieldset :toggleable="true">
                            <template #legend>
                                <i class="pi pi-users"></i>
                                <b>{{RKW_Web.AlbumDetailArtistInfoTitle}}</b>
                            </template>
                            <div class="grid ml-4" v-if="album.artists.length != 0">
                                <table class="table-borderless table-sm">
                                    <tbody class="detail-item-artists-table">
                                    <tr v-for="item in album.artists">
                                        <td width="120px"><strong>{{item.pos}}</strong></td>
                                        <td>
                                            {{item.name.join(", ")}}
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div v-else>
                                <span class="emptyInfo"><em>{{RKW_Web.ItemDetailMessageNoArtistInfo}}</em></span>
                            </div>
                        </p-fieldset>
                        <!-- tracks info -->
                        <p-fieldset :toggleable="true">
                            <template #legend>
                                <i class="pi iconfont icon-playlist"></i>
                                <b>{{RKW_Web.AlbumDetailTrackInfoTitle}}</b>
                            </template>
                            <div v-if="album.trackInfo == null || JSON.stringify(album.trackInfo) == '{}' ">
                                <span class="emptyInfo"><em>{{RKW_Web.AlbumDetailMessageNoTrackInfo}}</em></span>
                            </div>
                            <div>
                                <p class="text-start"
                                   v-if="album.trackInfo != null && JSON.stringify(album.trackInfo) != '{}' ">
                                    {{RKW_Web.TotalDiscNum}}: <b>{{album.trackInfo.discList.length}} </b>
                                    {{RKW_Web.TotalTrackNum}}: <b>{{album.trackInfo.totalTracks}} </b>
                                    {{RKW_Web.TotalLength}}: <b>{{album.trackInfo.totalLength}}</b>
                                </p>
                            </div>
                            <div v-if="album.trackInfo != null && JSON.stringify(album.trackInfo) != '{}' "
                                 v-for="(disc, index) in album.trackInfo.discList">
                                <table class="table table-sm table-hover">
                                    <thead>
                                    <h5>
                                        Disc {{index+1}} ({{disc.mediaFormat}})
                                        <span v-if="disc.catalogNo != ''">[{{album.catalogNo+"-"+(index+1)}}]</span>
                                        {{disc.albumFormat}}
                                    </h5>
                                    </thead>
                                    <tbody class="detail-item-track-table">
                                    <tr v-for="(track, index) in disc.trackList">
                                        <th>{{index+1>9?index+1:"0"+(index+1)}}</th>
                                        <td nowrap="nowrap">
                                            <a :href="'/db/music/' + track.musicId">
                                                {{track.name}}
                                            </a>
                                        </td>
                                        <td class="text-end" style="color: #b0c4de">
                                            <span v-if="track.length == '00:00'">
                                                N/A
                                            </span>
                                            <span v-else>
                                                {{track.length}}
                                            </span>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <p class="text-end">
                                    {{RKW_Web.TrackNum}}: <b>{{disc.trackList.length}} </b>
                                    <span v-if="disc.discLength != '00:00'">
                                            {{RKW_Web.DiscLength}}: <b>{{disc.discLength}}</b>
                                        </span>
                                </p>
                            </div>
                        </p-fieldset>
                        <!-- description -->
                        <div th:insert="~{template/item-detail-template :: description_field_set}"></div>
                        <!-- bonus -->
                        <div v-if="album.hasBonus">
                            <div th:insert="~{template/item-detail-template :: bonus_field_set}"></div>
                        </div>
                    </div>
                    <!--                    <p-fieldset :toggleable="true" class="mt-2">-->
                    <!--                        <template #legend>-->
                    <!--                            <i class="pi pi-images"></i>-->
                    <!--                            <b>图片</b>-->
                    <!--                        </template>-->
                    <!--                        <div v-if="album.displayImages.length == 0">-->
                    <!--                            <span class="emptyInfo"><em>暂无图片</em></span>-->
                    <!--                        </div>-->
                    <!--                        <div v-else align="center">-->
                    <!--                            <p-inplace>-->
                    <!--                                <template #display>-->
                    <!--                                    <span class="pi pi-eye" style="vertical-align: middle"></span>-->
                    <!--                                    <span style="margin-left:.5rem; vertical-align: middle">加载图片</span>-->
                    <!--                                </template>-->
                    <!--                                <template #content>-->
                    <!--                                    <p-galleria :value="album.displayImages" :responsive-options="responsiveOptions"-->
                    <!--                                                :num-visible="5" container-style="width: 600px" :circular="true">-->
                    <!--                                        <template #item="{item}">-->
                    <!--                                            <div id="galleria-div">-->
                    <!--                                                <img :class="galleriaItemClass" :src="item.url" :alt="item.name"-->
                    <!--                                                     :onload="initImageClass(item.url)"/>-->
                    <!--                                            </div>-->
                    <!--                                        </template>-->
                    <!--                                        <template #caption="{item}">-->
                    <!--                                            <div class="custom-galleria-footer">-->
                    <!--                                            <span v-if="album.displayImages" class="title-container">-->
                    <!--                                                <span>共{{album.displayImages.length}}张</span>-->
                    <!--                                                <span class="title">{{item.nameZh}}</span>-->
                    <!--                                                <span style="font-size: 10px">{{item.description}}</span>-->
                    <!--                                            </span>-->
                    <!--                                            </div>-->
                    <!--                                        </template>-->
                    <!--                                        <template #thumbnail="{item}">-->
                    <!--                                            <div class="grid grid-nogutter justify-content-center">-->
                    <!--                                                <img id="galleria-item" :src="item.thumbUrl" :alt="item.name"-->
                    <!--                                                     class="galleria-thumb-image"/>-->
                    <!--                                            </div>-->
                    <!--                                        </template>-->
                    <!--                                    </p-galleria>-->
                    <!--                                </template>-->
                    <!--                            </p-inplace>-->
                    <!--                        </div>-->
                    <!--                    </p-fieldset>-->
                </template>
            </p-card>
        </div>
        <div class="col-2" style="min-width: 300px">
            <div th:insert="~{template/item-detail-template :: belong_to_panel}"></div>
            <div class="mt-2" th:insert="~{template/item-detail-template :: sider_image_panel}"></div>
            <div class="mt-2" th:insert="~{template/item-detail-template :: index_loading_related_item_panel}"></div>
            <p-panel class="mt-2" v-if="!relatedItemLoad">
                <template #header>
                    <span class="text-start side-panel-header">
                        <i class="pi iconfont icon-album"></i><span><strong>{{RKW_Web.RelatedAlbumTitle}}</strong></span>
                    </span>
                </template>
                <div class="grid" v-if="relatedAlbums.length != 0">
                    <span class="small_font">
                        <div class="info_bit_small small_font grid m-0 p-0"
                             v-if="relatedAlbums.length != 0"
                             v-for="relatedAlbum of relatedAlbums">
                            <div class="sidebar-panel-image-small-div album_info_bit_thumb mt-2">
                                <a :href="'/db/album/'+ relatedAlbum.id">
                                    <img class="sidebar-panel-image-small" :src="relatedAlbum.cover.blackUrl"
                                         v-tooltip.bottom="RKW_Web.AddedTime + ': ' + relatedAlbum.addedTime + RKW_Web.EditedTime + ': ' + relatedAlbum.editedTime">
                                </a>
                            </div>
                            <div class="col p-0" style="height: 80px">
                                <ul class="info_bit_small_other">
                                    <li>
                                        <a class="small_font"
                                           :href="'/db/album/'+ relatedAlbum.id ">
                                            <span class="text-truncate-2 mr-2">
                                                {{relatedAlbum.name}}
                                            </span>
                                        </a>
                                    </li>
                                    <li>
                                        <span class="small_font col-6 related-item-catalog">
                                            {{relatedAlbum.catalogNo ? relatedAlbum.catalogNo : 'N/A'}}
                                        </span>
                                        <span class="small_font col-6 related-item-date">
                                            {{relatedAlbum.releaseDate}}
                                        </span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </span>
                </div>
                <div v-else>
                    <span class="emptyInfo"><em>{{RKW_Web.ItemDetailMessageNoRelatedItem}}</em></span>
                </div>
            </p-panel>
            <div th:insert="~{template/item-detail-template :: page_info_card}"></div>
        </div>
    </div>
    <p-dialog :modal="true" v-model:visible="displayEditDialog" :header="RKW_Web.ItemDetailBaseInfoEditTitle"
              :style="{width: '800px'}" class="p-fluid">
        <p-blockui :blocked="editBlock">
            <div class="formgrid grid">
                <div class="field col">
                    <label>{{RKW_Web.AlbumName}}<span style="color: red">*</span></label>
                    <p-inputtext id="name" v-model.trim="albumEdit.name"></p-inputtext>
                </div>
                <div class="field col">
                    <label>{{RKW_Web.AlbumEnglishName}}</label>
                    <p-inputtext id="nameEn" v-model.trim="albumEdit.nameEn"></p-inputtext>
                </div>
                <div class="field col">
                    <label>{{RKW_Web.AlbumChineseName}}</label>
                    <p-inputtext id="nameZh" v-model.trim="albumEdit.nameZh"></p-inputtext>
                </div>
            </div>
            <div class="formgrid grid">
                <div class="field col">
                    <label>{{RKW_Web.AlbumCatalogNo}}</label>
                    <p-inputtext id="catalogNo" v-model.trim="albumEdit.catalogNo"></p-inputtext>
                </div>
                <div class="field col">
                    <label>{{RKW_Web.Barcode}}</label>
                    <p-inputtext id="barcode" v-model.trim="albumEdit.barcode"></p-inputtext>
                </div>
            </div>
            <div class="formgrid grid">
                <div class="field col-6">
                    <label>{{RKW_Web.ReleaseDate}}<span style="color: red">*</span></label>
                    <p-calendar id="releaseDate" v-model="albumEdit.releaseDate" date-format="yy/mm/dd"
                                :show-button-bar="true"
                                :show-icon="true"></p-calendar>
                </div>
                <div class="field col-3">
                    <label>{{RKW_Web.ReleasePrice}}</label>
                    <p-inputnumber id="price" v-model="albumEdit.price"></p-inputnumber>
                </div>
                <div class="field col-3">
                    <label>{{RKW_Web.CurrencyUnit}}</label>
                    <p-dropdown v-model="albumEdit.currencyUnit" :options="currencyUnitSet"
                                option-label="label" option-value="value" :placeholder="RKW_Web.PlaceholderCurrencyUnit">
                    </p-dropdown>
                </div>
            </div>
            <div class="formgrid grid">
                <div class="field col-4">
                    <label class="mb-3">{{RKW_Web.BelongToFranchises}}<span style="color: red">*</span></label>
                    <p-multiselect v-model="albumEdit.franchises" @change="getProducts($event)"
                                   :options="franchiseSet" :placeholder="RKW_Web.PlaceholderBelongToFranchises"
                                   option-label="label" option-value="value" display="chip" :filter="true">
                    </p-multiselect>
                </div>
                <div class="field col-6">
                    <label class="mb-3">{{RKW_Web.BelongToProducts}}<span style="color: red">*</span></label>
                    <p-multiselect v-model="albumEdit.products" :options="productSet"
                                   option-label="label" option-value="value" :placeholder="RKW_Web.PlaceholderBelongToProducts"
                                   display="chip" :filter="true" :disabled="productSelect">
                    </p-multiselect>
                </div>
                <div class="field col">
                    <div class="col-12">
                        <label class="mb-3">{{RKW_Web.Bonus}}</label>
                    </div>
                    <div class="col-12 mt-4">
                        <p-inputswitch v-model="albumEdit.hasBonus" :true-value="1"
                                       :false-value="0"></p-inputswitch>
                    </div>
                </div>
            </div>
            <div class="formgrid grid">
                <div class="field col-4">
                    <label class="mb-3">{{RKW_Web.PublishFormat}}<span
                            style="color: red">*</span></label>
                    <p-multiselect id="publishFormat" v-model="albumEdit.publishFormat"
                                   :options="publishFormatSet"
                                   option-label="label" option-value="value"
                                   display="chip">
                    </p-multiselect>
                </div>
                <div class="field col-4">
                    <label class="mb-3">{{RKW_Web.AlbumFormat}}<span style="color: red">*</span></label>
                    <p-multiselect id="albumFormat" v-model="albumEdit.albumFormat" :options="albumFormatSet"
                                   option-label="label" option-value="value"
                                   display="chip">
                    </p-multiselect>
                </div>
                <div class="field col-4">
                    <label class="mb-3">{{RKW_Web.MediaFormat}}<span style="color: red">*</span></label>
                    <p-multiselect id="mediaFormat" v-model="albumEdit.mediaFormat" :options="mediaFormatSet"
                                   option-label="label" option-value="value"
                                   display="chip">
                    </p-multiselect>
                </div>
            </div>
            <div class="formgrid grid">
                <div class="field col">
                    <label>{{RKW_Web.AlbumLabel}}</label>
                    <p-inputtext id="label" v-model.trim="albumEdit.label"></p-inputtext>
                </div>
                <div class="field col">
                    <label>{{RKW_Web.AlbumPublisher}}</label>
                    <p-inputtext id="publisher" v-model.trim="albumEdit.publisher"></p-inputtext>
                </div>
                <div class="field col">
                    <label>{{RKW_Web.Distributor}}</label>
                    <p-inputtext id="distributor" v-model.trim="albumEdit.distributor"></p-inputtext>
                </div>
                <div class="field col">
                    <label>{{RKW_Web.Copyright}}</label>
                    <p-inputtext id="copyright" v-model.trim="albumEdit.copyright"></p-inputtext>
                </div>
            </div>
            <div class="field">
                <label>{{RKW_Web.Remark}}</label>
                <p-textarea id="remark" v-model="albumEdit.remark" rows="3" cols="20"
                            :auto-resize="true"></p-textarea>
            </div>
        </p-blockui>
        <template #footer>
            <p-button :label="RKW_Web.Cancel" icon="pi pi-times" class="p-button-text"
                      @click="closeEditDialog" :disabled="editBlock"></p-button>
            <p-button :label="RKW_Web.Save" icon="pi pi-check" class="p-button-text"
                      @click="submitEditAlbum" :disabled="editBlock"></p-button>
        </template>
    </p-dialog>
    <p-dialog :modal="true" v-model:visible="displayArtistEditDialog" :header="RKW_Web.AlbumDetailArtistEditTitle"
              :style="{width: '800px'}">
        <p-blockui :blocked="editBlock">
            <p-panel>
                <template #header>
                    <i class="pi pi-user-plus mr-2" style="font-size: 2rem"></i>
                    <b>{{RKW_Web.Add}}</b>
                </template>
                <div class="grid">
                    <div class="col-3">
                        <div class="p-inputgroup">
                            <span class="p-inputgroup-addon">
                                <i class="pi pi-tag"></i>
                            </span>
                            <span class="p-inputgroup-addon">
                                <p-checkbox v-model="artist.main" :true-value="1" :false-value="0"></p-checkbox>
                            </span>
                            <p-inputtext v-model="artist.pos" :placeholder="RKW_Web.AlbumDetailEditArtistPos"></p-inputtext>
                        </div>
                    </div>
                    <div class="col-7">
                        <div class="p-inputgroup">
                                        <span class="p-inputgroup-addon">
                                            <i class="pi pi-users"></i>
                                        </span>
                            <p-chips v-model="artist.name" :placeholder="RKW_Web.AlbumDetailEditArtistName" separator=","></p-chips>
                        </div>
                    </div>
                    <div class="col-2">
                        <p-button :label="RKW_Web.Add" icon="pi pi-save"
                                  @click="addArtist"></p-button>
                    </div>
                </div>
            </p-panel>
            <p-panel>
                <template #header>
                    <i class="pi pi-user-edit mr-2" style="font-size: 2rem"></i>
                    <b>{{RKW_Web.Edit}}</b>
                </template>
                <div v-if="tmpArtists.length != 0">
                    <p-datatable dataKey="id" :value="tmpArtists" responsive-layout="scroll"
                                 class="p-datatable-sm" striped-rows @row-reorder="onRowReorder"
                                 context-menu v-model:context-menu-selection="selectedArtist"
                                 @row-contextmenu="artistRowMenu" edit-mode="row"
                                 v-model:editing-rows="editingRows" @row-edit-save="onRowEditSave">
                        <p-column :row-reorder="true"></p-column>
                        <p-column field="pos" :header="RKW_Web.AlbumDetailEditArtistPos">
                            <template #editor="{ data, field }">
                                <p-inputtext v-model="data[field]" autofocus></p-inputtext>
                            </template>
                        </p-column>
                        <p-column field="name" :header="RKW_Web.AlbumDetailEditArtistName">
                            <template #body="slotProps">
                                {{slotProps.data.name.join(" / ")}}
                            </template>
                            <template #editor="{ data, field }">
                                <p-chips v-model="data[field]"></p-chips>
                            </template>
                        </p-column>
                        <p-column :row-editor="true" style="width:10%; min-width:8rem"
                                  bodyStyle="text-align:center"></p-column>
                    </p-datatable>
                    <p-contextmenu :model="menuModel" ref="cm"></p-contextmenu>
                </div>
                <div v-else>
                    <span class="emptyInfo">{{RKW_Web.ItemDetailMessageNoArtistInfo}}</span>
                </div>
            </p-panel>
        </p-blockui>
        <template #footer>
            <p-button :label="RKW_Web.Clear" icon="pi pi-trash" class="p-button-danger mr-4"
                      @click="clearArtists" :disabled="editBlock"></p-button>
            <p-button :label="RKW_Web.Cancel" icon="pi pi-times" class="mr-4"
                      @click="cancelArtistEdit" :disabled="editBlock"></p-button>
            <p-button :label="RKW_Web.Update" icon="pi pi-save" class="p-button-success mr-4"
                      @click="submitArtist" :disabled="editBlock"></p-button>
        </template>
    </p-dialog>
    <p-dialog :modal="true" v-model:visible="displayTrackEditDialog" :header="RKW_Web.AlbumDetailTrackEditTitle"
              :style="{width: '800px'}">
        <p-blockui :blocked="editBlock">
            <p-panel>
                <template #header>
                    <i class="pi pi-plus-circle mr-2" style="font-size: 2rem"></i>
                    <b>{{RKW_Web.Add}}</b>
                </template>
                <div class="grid">
                    <div class="col-10">
                        <div class="p-inputgroup">
                                        <span class="p-inputgroup-addon">
                                            <i class="pi pi-tag"></i>
                                        </span>
                            <p-chips v-model="tracks.audioNames" :placeholder="RKW_Web.AlbumDetailEditTrackAudioNames"></p-chips>
                        </div>
                    </div>
                    <div class="col-10">
                        <div class="p-inputgroup">
                                        <span class="p-inputgroup-addon">
                                            <i class="pi pi-users"></i>
                                        </span>
                            <p-chips v-model="tracks.audioLengths" :placeholder="RKW_Web.AlbumDetailEditTrackAudioLengths"
                                     separator=","></p-chips>
                        </div>
                    </div>

                    <div class="col-5">
                        <div class="p-inputgroup">
                                        <span class="p-inputgroup-addon">
                                            <i class="pi pi-tag"></i>
                                        </span>
                            <p-multiselect id="mediaFormat" v-model="disc.mediaFormat" :options="mediaFormatSet"
                                           option-label="label" option-value="labelEn" :placeholder="RKW_Web.MediaFormat"
                                           display="chip">
                            </p-multiselect>
                        </div>
                    </div>
                    <div class="col-5">
                        <div class="p-inputgroup">
                                        <span class="p-inputgroup-addon">
                                            <i class="pi pi-tag"></i>
                                        </span>
                            <p-multiselect id="albumFormat" v-model="disc.albumFormat" :options="albumFormatSet"
                                           option-label="label" option-value="labelEn" :placeholder="RKW_Web.AlbumFormat"
                                           display="chip">
                            </p-multiselect>
                        </div>
                    </div>

                    <div class="col-2">
                        <p-button :label="RKW_Web.AlbumDetailEditTrackDiscAdd" icon="pi pi-save" class="p-button-success"
                                  @click="addDisc"></p-button>
                    </div>
                </div>
            </p-panel>
            <p-panel>
                <template #header>
                    <i class="pi pi-pencil mr-2" style="font-size: 2rem"></i>
                    <b>{{RKW_Web.Edit}}</b>
                </template>
                <div v-if="tmpEditDiscList.length != 0">
                    <p-datatable :value="tmpEditDiscList" class="p-datatable-sm" striped-rows
                                 responsive-layout="scroll" v-model:expanded-rows="expandedRows"
                                 @row-reorder="onRowReorderDisc"
                                 context-menu v-model:context-menu-selection="selectedDisc"
                                 @row-contextmenu="discRowMenu" edit-mode="row"
                                 v-model:editing-rows="editingRowsDisc" @row-edit-save="onRowEditSaveDisc">
                        <template #header>
                            <div class="table-header-container">
                                <p-button icon="pi pi-plus" :label="RKW_Web.ExpandAll" @click="expandAll"
                                          class="mr-2"></p-button>
                                <p-button icon="pi pi-minus" :label="RKW_Web.CollapseAll" @click="collapseAll"></p-button>
                            </div>
                        </template>
                        <p-column :row-reorder="true"></p-column>
                        <p-column :expander="true" headerStyle="width: 3rem"></p-column>
                        <p-column :header="RKW_Web.AlbumDetailEditTrackDiscIndex">
                            <template #body="slotProps">
                                {{slotProps.index+1}}
                            </template>
                        </p-column>
                        <p-column field="albumFormat" :header="RKW_Web.AlbumFormat">
                            <template #body="slotProps">
                                {{slotProps.data.albumFormat.join("/")}}
                            </template>
                            <template #editor="{ data, field }">
                                <p-multiselect v-model="data[field]" :options="albumFormatSet"
                                               option-label="label" option-value="labelEn"
                                               :placeholder="RKW_Web.AlbumFormat"
                                               display="chip">
                                </p-multiselect>
                            </template>
                        </p-column>
                        <p-column field="mediaFormat" :header="RKW_Web.MediaFormat">
                            <template #body="slotProps">
                                {{slotProps.data.mediaFormat.join("/")}}
                            </template>
                            <template #editor="{ data, field }">
                                <p-multiselect v-model="data[field]" :options="mediaFormatSet"
                                               option-label="label" option-value="labelEn"
                                               :placeholder="RKW_Web.MediaFormat"
                                               display="chip">
                                </p-multiselect>
                            </template>
                        </p-column>
                        <p-column :row-editor="true" style="width:10%; min-width:8rem"
                                  bodyStyle="text-align:center"></p-column>
                        <template #expansion="slotProps">
                            <div class="orders-subtable">
                                <p-datatable :value="slotProps.data.trackList" class="p-datatable-sm"
                                             striped-rows
                                             responsive-layout="scroll"
                                             @row-reorder="onRowReorderTrack"
                                             context-menu v-model:context-menu-selection="selectedTrack"
                                             @row-contextmenu="trackRowMenu" edit-mode="row"
                                             v-model:editing-rows="editingRowsTrack"
                                             @row-edit-save="onRowEditSaveTrack">
                                    <p-column :row-reorder="true"></p-column>
                                    <p-column :header="RKW_Web.AlbumDetailEditTrackTrackIndex">
                                        <template #body="slotProps">
                                            {{slotProps.index+1}}
                                        </template>
                                    </p-column>
                                    <p-column field="musicId" :header="RKW_Web.AlbumDetailEditTrackTrackID" sortable></p-column>
                                    <p-column field="name" header="曲名">
                                        <template #editor="{ data, field }">
                                            <p-inputtext v-model="data[field]" autofocus></p-inputtext>
                                        </template>
                                    </p-column>
                                    <p-column field="length" :header="RKW_Web.AlbumDetailEditTrackTrackLength">
                                        <template #editor="{ data, field }">
                                            <p-inputtext v-model="data[field]" autofocus></p-inputtext>
                                        </template>
                                    </p-column>
                                    <p-column :row-editor="true" style="width:10%; min-width:8rem"
                                              bodyStyle="text-align:center"></p-column>
                                    <p-contextmenu :model="menuModelTrack" ref="cmTrack"></p-contextmenu>
                                </p-datatable>
                            </div>
                        </template>
                        <p-contextmenu :model="menuModelDisc" ref="cmDisc"></p-contextmenu>
                    </p-datatable>
                </div>
                <div v-else>
                    <span class="emptyInfo">{{RKW_Web.AlbumDetailMessageNoTrackInfo}}</span>
                </div>
            </p-panel>
        </p-blockui>
        <template #footer>
            <p-button :label="RKW_Web.Save" icon="pi pi-save" class="p-button-success mr-4"
                      @click="submitTrackInfo" :disabled="editBlock"></p-button>
        </template>
    </p-dialog>

    <p-dynamicdialog></p-dynamicdialog>
    <!-- footer -->
    <footer class="mt-2" th:insert="~{template/footer :: site_footer}"></footer>
</div>
<script type="module" th:inline="javascript">

    import {RKW_Web} from '/js/basic/Rakbow_Web_Control_Strs_CN.js';
    import {marked} from '/tool/marked/marked.esm.js';
    import {HttpUtil} from '/js/basic/Http_Util.js';
    import {showSearchPanel} from '/js/basic/Rakbow_Web_Search_Params.js';
    import {showImageEditDialog} from '/js/basic/Item_Detail_Image_Params.js';
    import {showBonusEditDialog, showDescriptionEditDialog} from '/js/basic/Item_Detail_Text_Params.js';
    const {createApp, onMounted, ref} = Vue;
    const Tooltip = primevue.tooltip;
    const {useDialog} = primevue.usedialog;
    const {useToast} = primevue.usetoast;
    const App = {
        setup() {
            onMounted(() => {
                init();
                $(window).resize(function () {
                    $("#main").attr("style", "min-height:" + ($(window).height() - 350) + 'px');
                });
                getRelatedAlbums();
            })

            //region tingle
            const descriptionModal = new tingle.modal({
                closeMethods: ['overlay', 'button', 'escape'],
                closeLabel: "Close",
                cssClass: ['tingle-markdown-body'],
                onOpen: function () {
                    if (detailInfo.value.description != null && detailInfo.value.description !== "") {
                        descriptionModal.setContent(marked.parse(detailInfo.value.description));
                    }
                }
            });
            const bonusModal = new tingle.modal({
                closeMethods: ['overlay', 'button', 'escape'],
                closeLabel: "Close",
                cssClass: ['tingle-markdown-body'],
                onOpen: function () {
                    if (album.value.hasBonus && album.value.bonus != null && album.value.bonus !== "") {
                        bonusModal.setContent(marked.parse(album.value.bonus));
                    }
                }
            });

            const openTingleDescription = () => {
                descriptionModal.open();
            };
            const openTingleBonus = () => {
                bonusModal.open();
            };
            //endregion

            //region common header
            const dialog = useDialog();
            const openSearchPanel = () => {
                showSearchPanel(dialog);
            }
            //endregion

            //region basic
            const toast = useToast();
            const album = ref([[${album}]]);
            const pageInfo = ref([[${pageInfo}]]);
            const detailInfo = ref([[${detailInfo}]]);
            const itemImageInfo = ref([[${itemImageInfo}]]);
            const relatedItemLoad = ref(true);
            const relatedAlbums = ref([]);
            const franchiseSet = ref([[${options.franchiseSet}]]);
            const productSet = ref([]);
            const productSelect = ref(true);
            const mediaFormatSet = ref([[${options.mediaFormatSet}]]);
            const albumFormatSet = ref([[${options.albumFormatSet}]]);
            const publishFormatSet = ref([[${options.publishFormatSet}]]);
            //endregion

            //region init
            const init = () => {
                text2marked();
                $("#main").attr("style", "min-height:" + ($(window).height() - 350) + 'px');
                createAplayer();
            };
            const text2marked = () => {

                if (detailInfo.value.description != null && detailInfo.value.description !== "") {
                    document.getElementById("description").innerHTML = marked.parse(detailInfo.value.description);
                }

                if (album.value.hasBonus && album.value.bonus != null && album.value.bonus !== "") {
                    document.getElementById("bonus").innerHTML = marked.parse(album.value.bonus);
                }
                if ((album.value.bonus == null || album.value.bonus === "") && album.value.hasBonus) {
                    //<![CDATA[
                    document.getElementById("bonus").innerHTML = "<span class='emptyInfo'><em>" + RKW_Web.ItemDetailMessageNoBonusInfo + "</em></span>";
                    //]]>
                }
            };
            //endregion

            //region image
            const activeIndex = ref(0)
            const displayCustom = ref(false)
            const imageClick = (index) => {
                activeIndex.value = index;
                displayCustom.value = true;
            };
            //endregion

            //region audio player
            const audioInfos = ref([[${audioInfos}]]);
            const playerOption = ref({
                fixed: false,
            });
            const createAplayer = () => {

                if (audioInfos.value !== null) {
                    const ap = new APlayer({
                        container: document.getElementById('aplayer'),
                        theme: '#e9e9e9',
                        volume: 0.5,
                        lrcType: 3,
                        fixed: playerOption.value.fixed,
                        audio: audioInfos.value
                    });
                    const colorThief = new ColorThief();
                    const image = new Image();
                    const xhr = new XMLHttpRequest();
                    const setTheme = (index) => {
                        if (!ap.list.audios[index].theme) {
                            xhr.onload = function () {
                                let coverUrl = URL.createObjectURL(this.response);
                                image.onload = function () {
                                    let color = colorThief.getColor(image);
                                    ap.theme(`rgb(${color[0]}, ${color[1]}, ${color[2]})`, index);
                                    URL.revokeObjectURL(coverUrl)
                                };
                                image.src = coverUrl;
                            }
                            xhr.open('GET', ap.list.audios[index].cover, true);
                            xhr.responseType = 'blob';
                            xhr.send();
                        }
                    };
                    setTheme(ap.list.index);
                    ap.on('listswitch', (index) => {
                        setTheme(index);
                    });
                } else {
                    //<![CDATA[
                    document.getElementById('aplayer').innerHTML = "<span class='emptyInfo'>" + RKW_Web.ItemDetailMessageNoAudioInfo + "</span>";
                    //]]>
                }
            }
            //endregion

            //region edit
            const edits = ref([
                {
                    label: RKW_Web.ItemDetailOptionImageEditTitle,
                    icon: 'pi pi-images',
                    command: () => {
                        showImageEditDialog(toast, dialog, itemImageInfo.value, detailInfo.value);
                    }
                },
                {
                    label: RKW_Web.AlbumDetailOptionArtistEditTitle,
                    icon: 'pi pi-users',
                    command: () => {
                        openArtistEditDialog();
                    }
                },
                {
                    label: RKW_Web.AlbumDetailOptionTrackInfoEditTitle,
                    icon: 'pi iconfont icon-playlist',
                    command: () => {
                        openTrackEditDialog();
                    }
                },
                {
                    label: RKW_Web.ItemDetailOptionDescriptionEditTitle,
                    icon: 'pi iconfont icon-miaoshu',
                    command: () => {
                        showDescriptionEditDialog(toast, dialog, detailInfo.value, itemImageInfo.value.images);
                    }
                },
                {
                    label: RKW_Web.ItemDetailOptionBonusEditTitle,
                    icon: 'pi iconfont icon-gift',
                    command: () => {
                        showBonusEditDialog(toast, dialog, detailInfo.value, album.value.bonus, itemImageInfo.value.images);
                    }
                }
            ]);
            //endregion

            //region edit basic info
            const editBlock = ref(false);
            const albumEdit = ref({});
            const displayEditDialog = ref(false);
            //打开编辑数据面板
            const openEditDialog = () => {
                let dataTmp = JSON.parse(JSON.stringify(album.value));
                dataTmp.hasBonus = album.value.hasBonus ? 1 : 0;
                albumEdit.value = dataTmp;
                albumEdit.value.mediaFormat = label2value(dataTmp.mediaFormat, mediaFormatSet.value).concat();
                albumEdit.value.albumFormat = label2value(dataTmp.albumFormat, albumFormatSet.value).concat();
                albumEdit.value.publishFormat = label2value(dataTmp.publishFormat, publishFormatSet.value).concat();
                albumEdit.value.franchises = label2value(detailInfo.value.franchises, franchiseSet.value).concat();
                let json = {
                    franchises: albumEdit.value.franchises,
                    entityType: ENTITY.ALBUM
                };
                HttpUtil.post(toast, GET_PRODUCT_SET_URL, json)
                    .then(res => {
                        if(res.state === 1) {
                            if (res.data.length !== 0) {
                                productSet.value = res.data;
                                productSelect.value = false;
                            } else {
                                productSelect.value = true;
                            }
                            albumEdit.value.products = label2value(detailInfo.value.products, productSet.value).concat();
                            displayEditDialog.value = true;
                        }
                    });
            };
            //关闭编辑数据面板
            const closeEditDialog = () => {
                displayEditDialog.value = false;
                albumEdit.value = {};
            };
            //保存编辑数据
            const submitEditAlbum = () => {
                editBlock.value = true;
                HttpUtil.commonSubmit(toast, editBlock, UPDATE_ALBUM_URL, albumEdit.value)
                    .then(res => {
                        if (res !== undefined) {
                            albumEdit.value = {};
                            closeEditDialog();
                            location.reload(true);
                        }
                    })
                    .catch(error => {
                        console.error(error);
                    });
            };
            //根据系列id获取该系列所有作品
            const getProducts = (ev) => {
                if(ev.value.length !== 0) {
                    let json = {
                        franchises: ev.value,
                        entityType: ENTITY.ALBUM
                    };
                    HttpUtil.post(null, GET_PRODUCT_SET_URL, json)
                        .then(res => {
                            if(res.state === 1) {
                                if (res.data.length !== 0) {
                                    productSet.value = res.data;
                                    productSelect.value = false;
                                } else {
                                    productSelect.value = true;
                                    albumEdit.value.products = [];
                                }
                            }
                        });
                }else {
                    productSelect.value = true;
                    albumEdit.value.products = [];
                }
            };
            const like = () => {
                let json = {
                    entityType: ENTITY.ALBUM,
                    entityId: detailInfo.value.id
                }
                HttpUtil.post(toast, LIKE_ITEM_URL, json)
                    .then(res => {
                        if (res.state === 1) {
                            pageInfo.value.likeCount++;
                            pageInfo.value.liked = true;
                        }
                    });
            };
            const updateStatus = () => {
                editBlock.value = true;
                let json = {
                    entityType: ENTITY.ALBUM,
                    entityId: detailInfo.value.id,
                    status: !detailInfo.value.status
                };
                HttpUtil.commonSubmit(toast, editBlock, UPDATE_ITEM_STATUS, json);
            };
            //endregion

            //region tracks info
            let tmpDiscId = 1000;
            let tmpTrackId = 1000;
            const tmpEditDiscList = ref();
            const cmDisc = ref();
            const cmTrack = ref();
            const selectedDisc = ref();
            const selectedTrack = ref();
            const menuModelDisc = ref([
                {label: RKW_Web.Delete, icon: 'pi pi-fw pi-trash', command: () => deleteDisc(selectedDisc)}
            ]);
            const menuModelTrack = ref([
                {label: RKW_Web.Delete, icon: 'pi pi-fw pi-trash', command: () => deleteTrack(selectedTrack)}
            ]);
            const onRowReorderDisc = (ev) => {
                tmpEditDiscList.value = ev.value;
            };
            const onRowReorderTrack = (ev) => {

                for (let disc of tmpEditDiscList.value) {
                    if (disc.tmpDiscId === ev.value[0].tmpDiscId) {
                        disc.trackList = ev.value;
                    }
                }
            };
            const discRowMenu = (ev) => {
                cmDisc.value.show(ev.originalEvent);
            };
            const trackRowMenu = (ev) => {
                cmTrack.value.show(ev.originalEvent);
            };
            const deleteDisc = (disc) => {
                tmpEditDiscList.value = tmpEditDiscList.value.filter((d) => d.tmpDiscId !== disc.value.tmpDiscId);
                toast.add({severity: 'error', summary: RKW_Web.MessageDeleted, detail: disc.value.tmpDiscId, life: 3000});
                selectedArtist.value = null;
            };
            const deleteTrack = (track) => {
                for (let disc of tmpEditDiscList.value) {
                    if (disc.tmpDiscId === track.value.tmpDiscId) {
                        disc.trackList = disc.trackList.filter((t) => t.tmpTrackId !== track.value.tmpTrackId);
                    }
                }
                toast.add({severity: 'error', summary: RKW_Web.MessageDeleted, detail: track.value.name, life: 3000});
            };
            const editingRowsDisc = ref([]);
            const editingRowsTrack = ref([]);
            const onRowEditSaveDisc = (ev) => {
                let {newData, index} = ev;
                tmpEditDiscList.value[index] = newData;
            };
            const onRowEditSaveTrack = (ev) => {
                let {newData, index} = ev;

                for (let disc of tmpEditDiscList.value) {
                    if (disc.tmpDiscId === newData.tmpDiscId) {
                        disc.trackList[index] = newData;
                    }
                }
            };

            const tracks = ref({
                audioNames: [],
                audioLengths: []
            });
            const disc = ref({
                albumFormat: [],
                mediaFormat: []
            });
            const expandedRows = ref([]);
            const expandAll = () => {
                expandedRows.value = tmpEditDiscList.value;
            };
            const collapseAll = () => {
                expandedRows.value = null;
            };
            const displayTrackEditDialog = ref(false);

            const openTrackEditDialog = () => {
                tmpEditDiscList.value = JSON.parse(JSON.stringify(album.value.editDiscList));
                tracks.value = {};
                disc.value = {};
                displayTrackEditDialog.value = true;
            };
            const checkDisc = () => {
                if (tracks.value.audioNames === undefined || tracks.value.audioNames.length === 0) {
                    toast.add({
                        severity: 'error',
                        summary: 'Error',
                        detail: ALBUM_DETAIL_TRACK_INFO_MUSIC_NAME_EMPTY,
                        life: 3000
                    });
                    return false;
                }
                if (tracks.value.audioLengths === undefined || tracks.value.audioLengths.length === 0) {
                    toast.add({
                        severity: 'error',
                        summary: 'Error',
                        detail: ALBUM_DETAIL_TRACK_INFO_MUSIC_LENGTH_EMPTY,
                        life: 3000
                    });
                    return false;
                }
                if (tracks.value.audioLengths.length !== tracks.value.audioNames.length) {
                    toast.add({
                        severity: 'error',
                        summary: 'Error',
                        detail: ALBUM_DETAIL_TRACK_INFO_MUSIC_NOT_EQUALS,
                        life: 3000
                    });
                    return false;
                }
                if (disc.value.mediaFormat === undefined) {
                    toast.add({
                        severity: 'error',
                        summary: 'Error',
                        detail: ALBUM_DETAIL_TRACK_INFO_MEDIA_FORMAT_EMPTY,
                        life: 3000
                    });
                    return false;
                }
                if (disc.value.albumFormat === undefined) {
                    toast.add({
                        severity: 'error',
                        summary: 'Error',
                        detail: ALBUM_DETAIL_TRACK_INFO_ALBUM_FORMAT_EMPTY,
                        life: 3000
                    });
                    return false;
                }
                return true;
            }
            const addDisc = () => {
                if (checkDisc()) {
                    let newDisc = {
                        tmpDiscId: tmpDiscId,
                        trackList: [],
                        mediaFormat: [],
                        albumFormat: []
                    };
                    for (let i = 0; i < tracks.value.audioNames.length; i++) {
                        let track = {
                            tmpDiscId: tmpDiscId,
                            tmpTrackId: tmpTrackId,
                            musicId: 0,
                            name: null,
                            length: null
                        };
                        track.name = tracks.value.audioNames[i];
                        track.length = tracks.value.audioLengths[i];
                        newDisc.trackList.push(track);
                        tmpTrackId++;
                    }
                    newDisc.albumFormat = disc.value.albumFormat;
                    newDisc.mediaFormat = disc.value.mediaFormat;
                    tmpEditDiscList.value.push(newDisc);
                    tracks.value = {};
                    disc.value = {};
                    tmpDiscId++;
                }
            };
            const submitTrackInfo = () => {
                editBlock.value = true;
                let json = {
                    id: album.value.id,
                    discList: tmpEditDiscList.value
                }
                HttpUtil.commonSubmit(toast, editBlock, UPDATE_ALBUM_TRACK_INFO_URL, json)
                    .then(res => {
                        if (res !== undefined) {
                            displayTrackEditDialog.value = false;
                            location.reload(true);
                        }
                    })
            };
            //endregion

            //region artists
            const tmpArtists = ref();
            const cm = ref();
            const selectedArtist = ref();
            const artist = ref({});
            const artists = ref([]);
            const displayArtistEditDialog = ref(false);
            const menuModel = ref([
                {label: RKW_Web.Delete, icon: 'pi pi-fw pi-user-minus', command: () => deleteArtist(selectedArtist)}
            ]);
            const onRowReorder = (ev) => {
                tmpArtists.value = ev.value;
            };
            const artistRowMenu = (ev) => {
                cm.value.show(ev.originalEvent);
            };
            const deleteArtist = (artist) => {
                tmpArtists.value = tmpArtists.value.filter((a) => a.pos !== artist.value.pos);
                toast.add({severity: 'error', summary: RKW_Web.MessageDeleted, detail: artist.value.pos, life: 3000});
                selectedArtist.value = null;
            };
            const editingRows = ref([]);
            const onRowEditSave = (ev) => {
                let {newData, index} = ev;

                tmpArtists.value[index] = newData;
            };

            const openArtistEditDialog = () => {
                tmpArtists.value = JSON.parse(JSON.stringify(album.value.artists));
                artist.value = {};
                displayArtistEditDialog.value = true;
            };
            const clearArtists = () => {
                tmpArtists.value = [];
            };
            const addArtist = () => {
                tmpArtists.value.push(artist.value);
                artist.value = {};
            }
            const cancelArtistEdit = () => {
                artist.value = {};
                displayArtistEditDialog.value = false;
            };
            const submitArtist = () => {
                editBlock.value = true;
                let json = {
                    id: album.value.id,
                    artists: tmpArtists.value
                }
                HttpUtil.commonSubmit(toast, editBlock, UPDATE_ALBUM_ARTISTS_URL, json)
                    .then(res => {
                        if (res !== undefined) {
                            displayArtistEditDialog.value = false;
                            artist.value = {};
                            location.reload(true);
                        }
                    })
            };
            const getRelatedAlbums = () => {
                relatedItemLoad.value = true;
                let json = {
                    id: detailInfo.value.id
                }
                HttpUtil.post(null, GET_RELATED_ALBUMS_URL, json)
                    .then(res => {
                        if (res.state === 1) {
                            relatedAlbums.value = res.data;
                        }
                        relatedItemLoad.value = false;
                    });
            };
            //endregion

            // const initImageClass = (url) => {
            //     const image = new Image();
            //     image.src = url;
            //     image.onload = function () {
            //         galleriaItemClass.value = (this.naturalWidth > this.naturalHeight) ? "galleria-div-width" : "galleria-div-height";
            //     }
            // }

            return {
                RKW_Web,
                openTingleDescription, openTingleBonus,

                //header
                dialog, openSearchPanel, NOT_LOGIN_NAVBAR_ITEMS, LOGIN_NAVBAR_ITEMS,

                //image
                activeIndex, displayCustom, imageClick, initGalleriaImageClass,

                //basic
                album, like, updateStatus, pageInfo, detailInfo, itemImageInfo, currencyUnitSet, getProducts, productSelect, franchiseSet,
                mediaFormatSet, albumFormatSet, publishFormatSet, productSet, relatedAlbums, responsiveOptions, relatedItemLoad, tmpList5,

                //edit
                editBlock, albumEdit, edits, displayEditDialog, openEditDialog, closeEditDialog, submitEditAlbum,

                //audio player
                audioInfos, createAplayer, playerOption,

                //artists
                tmpEditDiscList, tmpArtists, cm, artist, artists, menuModel, editingRows, selectedArtist, addArtist,
                clearArtists, submitArtist, deleteArtist, cancelArtistEdit, artistRowMenu, onRowEditSave,
                displayArtistEditDialog,

                //tracks info
                cmDisc, selectedDisc, menuModelDisc, onRowReorderDisc, discRowMenu, editingRowsDisc, onRowEditSaveDisc,
                cmTrack, selectedTrack, menuModelTrack, onRowReorderTrack, trackRowMenu, editingRowsTrack,
                onRowEditSaveTrack, tracks, disc, addDisc, submitTrackInfo, onRowReorder, expandedRows, expandAll,
                collapseAll, displayTrackEditDialog,
            }
        },
        components: {
            "p-panel": primevue.panel,
            "p-fieldset": primevue.fieldset,
            "p-button": primevue.button,
            "p-dialog": primevue.dialog,
            "p-chips": primevue.chips,
            "p-divider": primevue.divider,
            "p-inputtext": primevue.inputtext,
            "p-multiselect": primevue.multiselect,
            "p-galleria": primevue.galleria,
            "p-menubar": primevue.menubar,
            "p-avatar": primevue.avatar,
            "p-toast": primevue.toast,
            "p-dropdown": primevue.dropdown,
            "p-textarea": primevue.textarea,
            "p-calendar": primevue.calendar,
            "p-inputnumber": primevue.inputnumber,
            "p-inputswitch": primevue.inputswitch,
            "p-splitbutton": primevue.splitbutton,
            "p-datatable": primevue.datatable,
            "p-column": primevue.column,
            "p-contextmenu": primevue.contextmenu,
            "p-tag": primevue.tag,
            "p-card": primevue.card,
            "p-blockui": primevue.blockui,
            "p-skeleton": primevue.skeleton,
            "p-scrollpanel": primevue.scrollpanel,
            "p-scrolltop": primevue.scrolltop,
            "p-checkbox": primevue.checkbox,

            "p-dynamicdialog": primevue.dynamicdialog,
        }
    };

    const routes = [{path: ALBUM_DETAIL_URL +　[[${detailInfo.id}]], component: App}];

    const router = VueRouter.createRouter({
        history: VueRouter.createWebHistory(),
        routes
    });

    createApp(App)
        .use(router)
        .use(primevue.toastservice)
        .use(primevue.config.default)
        .directive('tooltip', Tooltip)
        .use(primevue.dialogservice)
        .use(MdEditorV3)
        .mount("#app");
</script>
<style>

    .aplayer .aplayer-list ol li {
        color: black;
    }

    .aplayer .aplayer-info .aplayer-music .aplayer-title {
        color: black;
    }

    .orders-subtable {
        padding: 1rem;
    }

    .album-detail-cover {
        transform: translateY(7px);
        width: 250px;
        height: 250px;
    }

</style>
</body>
</html>
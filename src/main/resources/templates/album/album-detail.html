<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Album Detail</title>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>

    <!-- bootstrap -->
    <link rel="stylesheet" th:href="@{/css/bootstrap/myBootstrap.min.css}">
    <script src="https://cdn.staticfile.org/bootstrap/5.2.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.staticfile.org/baguettebox.js/1.11.1/baguetteBox.min.js"></script>
    <link href="https://cdn.staticfile.org/baguettebox.js/1.11.1/baguetteBox.min.css" rel="stylesheet">

    <!--other css -->
    <link th:href="@{/img/favicon.ico}" type="image/x-icon" rel="shortcut icon"/>
    <link th:href="@{/css/index.css}" rel="stylesheet"/>
    <link th:href="@{/css/iconfont/iconfont.css}" rel="stylesheet" type="text/css"/>

    <!-- PrimeVue -->
    <link th:href="@{/css/primevue/themes/saga-blue/theme.css}" rel="stylesheet"/>
    <link th:href="@{/css/primevue/primevue.min.css}" rel="stylesheet"/>
    <link th:href="@{/css/primeflex/primeflex.min.css}" rel="stylesheet"/>
    <link th:href="@{/css/primeicons/primeicons.css}" rel="stylesheet"/>

    <!-- Vue3 -->
    <script src="https://cdn.staticfile.org/vue/3.2.41/vue.global.js"></script>
    <script th:src="@{/js/primevue/primevue.min.js}"></script>
    <script src="https://cdn.staticfile.org/vue-router/4.1.6/vue-router.global.js"></script>

    <!-- PrimeVue Components -->
    <script th:src="@{/js/primevue/components/fileupload.min.js}"></script>
    <script th:src="@{/js/primevue/components/panel.min.js}"></script>
    <script th:src="@{/js/primevue/components/divider.min.js}"></script>
    <script th:src="@{/js/primevue/components/dialog.min.js}"></script>
    <script th:src="@{/js/primevue/components/fieldset.min.js}"></script>
    <script th:src="@{/js/primevue/components/chips.min.js}"></script>
    <script th:src="@{/js/primevue/components/inputtext.min.js}"></script>
    <script th:src="@{/js/primevue/components/multiselect.min.js}"></script>
    <script th:src="@{/js/primevue/components/galleria.min.js}"></script>
    <script th:src="@{/js/primevue/components/menubar.min.js}"></script>
    <script th:src="@{/js/primevue/components/avatar.min.js}"></script>
    <script th:src="@{/js/primevue/components/toast.min.js}"></script>
    <script th:src="@{/js/primevue/components/toastservice.min.js}"></script>
    <script th:src="@{/js/primevue/components/textarea.min.js}"></script>
    <script th:src="@{/js/primevue/components/calendar.min.js}"></script>
    <script th:src="@{/js/primevue/components/inputnumber.min.js}"></script>
    <script th:src="@{/js/primevue/components/inputswitch.min.js}"></script>
    <script th:src="@{/js/primevue/components/splitbutton.min.js}"></script>
    <script th:src="@{/js/primevue/components/datatable.min.js}"></script>
    <script th:src="@{/js/primevue/components/column.min.js}"></script>
    <script th:src="@{/js/primevue/components/contextmenu.min.js}"></script>
    <script th:src="@{/js/primevue/components/inplace.min.js}"></script>

    <!-- Axios -->
    <script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>

    <!-- Jquery -->
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>

    <!-- high light js -->
    <link href="https://cdn.staticfile.org/highlight.js/11.6.0/styles/default.min.css" rel="stylesheet">
    <script src="https://cdn.staticfile.org/highlight.js/11.6.0/highlight.min.js"></script>

    <!-- md-editor-v3 -->
    <script th:src="@{/js/md-editor-v3/2.2.1/md-editor-v3.umd.js}"></script>
    <link th:href="@{/css/md-editor-v3/2.2.1/style.css}" rel="stylesheet">

    <!-- marked -->
    <script src="https://cdn.staticfile.org/marked/4.2.0/marked.min.js"></script>
    <link href="https://cdn.staticfile.org/github-markdown-css/5.1.0/github-markdown.css" rel="stylesheet">

    <!-- aPlayer -->
    <!--    <link href="https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.css" rel="stylesheet">-->
    <!--    <script src="https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.js"></script>-->

    <!-- basic js -->
    <script th:src="@{/js/basic/Data_Helper.js}"></script>
    <script th:src="@{/js/basic/Http_Request.js}"></script>
    <script th:src="@{/js/basic/Rakbow_Web_Helper_Str.js}"></script>
    <script th:src="@{/js/basic/Rakbow_Web_Exception_Str_CN.js}"></script>
</head>
<body>
<div class="nk-container">
    <div class="main">
        <div class="container">
            <div id="app">
                <!-- 头部 -->
                <header class="sticky-top mb-2" th:insert="~{template/header :: site_header}"></header>

                <div class="grid card mt-2">
                    <p-toast></p-toast>
                    <div class="col-12 sm:col-12 md:col-6 lg:col-9">
                        <p-panel>
                            <template #header>
                                <i class="pi iconfont icon-24gl-musicAlbum2 mr-0" style="font-size: 2rem"></i>
                                <div class="container mt-0 mb-0 ml-0">
                                    <h4 class="text-start ml-2 mt-0 mb-0" style="text-align: left">{{album.nameJp}}</h4>
                                    <h4 class="text-start ml-2 mt-0 mb-0" style="text-align: left"><small>{{album.nameEn}}</small>
                                    </h4>
                                    <h4 v-if="album.nameZh != ''" class="text-start ml-2 mt-0 mb-0"
                                        style="text-align: left"><small>{{album.nameZh}}</small></h4>
                                </div>
                            </template>
                            <template #icons th:if="${loginUser != null}">
                                <p-splitbutton :model="edits" class="p-button-rounded bg-primary mb-2"
                                               th:if="${loginUser.type == 1}">
                                    <p-button @click="openEditDialog">
                                        <i class="pi pi-pencil"></i>
                                        <span class="ml-2 flex align-items-center font-bold">编辑</span>
                                    </p-button>
                                </p-splitbutton>
                            </template>
                            <div class="grid">
                                <div class="ml-3" style="transform:translateY(33.8px);width: 250px; height: 250px">
                                    <img :src="album.cover.url" :alt="album.cover.name" class="image-cover"/>
                                </div>
                                <table class="table-borderless table-sm ml-3">
                                    <tbody>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-dingdanbianhao mr-1"
                                               style="font-size: 1.3rem"></i>
                                            <strong>专辑编号</strong>
                                        </td>
                                        <td>
                                            {{album.catalogNo?album.catalogNo:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-bar-code mr-1" style="font-size: 1.3rem"></i>
                                            <strong>商品条形码</strong>
                                        </td>
                                        <td>{{album.barcode?album.barcode:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi pi-calendar mr-1" style="font-size: 1.3rem"></i>
                                            <strong>发行时间</strong>
                                        </td>
                                        <td>
                                            {{album.releaseDate?album.releaseDate:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-wuliaojiage mr-1" style="font-size: 1.3rem"></i>
                                            <strong>发行价格</strong>
                                        </td>
                                        <td>
                                            {{album.publishPrice != 0 ? album.publishPrice + "日元(含税)" :"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-gift mr-1"
                                               style="font-size: 1.3rem"></i>
                                            <strong>特典</strong>
                                        </td>
                                        <td><a v-if="album.hasBonus" href="#bonus">有</a>{{(album.hasBonus)?"":"无"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi pi-print mr-1" style="font-size: 1.3rem"></i>
                                            <strong>出版形式</strong>
                                        </td>
                                        <td>
                                            {{album.publishFormat?album.publishFormat:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-zhuanjiguangpan mr-1"
                                               style="font-size: 1.3rem"></i>
                                            <strong>媒体类型</strong>
                                        </td>
                                        <td>
                                            {{album.mediaFormat?album.mediaFormat:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-musicfill mr-1" style="font-size: 1.3rem"></i>
                                            <strong>专辑类型</strong>
                                        </td>
                                        <td>
                                            {{album.albumFormat?album.albumFormat:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-tushuyinxiang mr-1"
                                               style="font-size: 1.3rem"></i>
                                            <strong>唱片公司</strong>
                                        </td>
                                        <td>{{album.label?album.label:"N/A"}}</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-gongsi mr-1" style="font-size: 1.3rem"></i>
                                            <strong>出版商</strong>
                                        </td>
                                        <td>
                                            {{album.publisher?album.publisher:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-company mr-1" style="font-size: 1.3rem"></i>
                                            <strong>经销商</strong>
                                        </td>
                                        <td>
                                            {{album.distributor?album.distributor:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-copyright mr-1" style="font-size: 1.3rem"></i>
                                            <strong>版权方</strong>
                                        </td>
                                        <td>
                                            {{album.copyright?album.copyright:"N/A"}}
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </p-panel>
                        <p-fieldset :toggleable="true" class="mt-2">
                            <template #legend>
                                <i class="pi pi-users mr-2" style="font-size: 2rem"></i>
                                <b>创作者信息</b>
                            </template>
                            <div class="grid" v-if="album.artists.length != 0">
                                <table class="table-borderless table-sm ml-10">
                                    <tbody>
                                    <tr v-for="item in album.artists">
                                        <td><strong>{{item.pos}}</strong></td>
                                        <td>
                                            {{item.name.join("/")}}
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div v-else>
                                <span class="emptyInfo"><em>暂无创作者相关信息</em></span>
                            </div>
                        </p-fieldset>
                        <p-fieldset :toggleable="true" class="mt-2">
                            <template #legend>
                                <i class="pi iconfont icon-playlist mr-2" style="font-size: 2rem"></i>
                                <b>音轨信息</b>
                            </template>
                            <div v-if="album.trackInfo == null || JSON.stringify(album.trackInfo) == '{}' ">
                                <span class="emptyInfo"><em>暂无音轨信息</em></span>
                            </div>
                            <div>
                                <p class="text-start"
                                   v-if="album.trackInfo != null && JSON.stringify(album.trackInfo) != '{}' ">
                                    总碟片数: <b>{{album.trackInfo.discList.length}} </b>
                                    总曲目数: <b>{{album.trackInfo.totalTracks}} </b>
                                    总时长: <b>{{album.trackInfo.totalLength}}</b>
                                </p>
                            </div>
                            <div v-if="album.trackInfo != null && JSON.stringify(album.trackInfo) != '{}' "
                                 v-for="(disc, index) in album.trackInfo.discList">
                                <table class="table table-sm table-hover table-striped">
                                    <thead>
                                    <h5>
                                        Disc {{index+1}} ({{disc.mediaFormat}})
                                        <span v-if="disc.catalogNo != ''">[{{album.catalogNo+"-"+(index+1)}}]</span>
                                        {{disc.albumFormat}}
                                    </h5>
                                    </thead>
                                    <tbody>
                                    <tr v-for="(track, index) in disc.trackList">
                                        <th scope="row">{{index+1>9?index+1:"0"+(index+1)}}</th>
                                        <td>
                                            <a :href="'/db/music/' + track.musicId">
                                                {{track.name}}
                                            </a>
                                        </td>
                                        <td class="text-end">{{track.length}}</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <p class="text-end">
                                    曲目数: <b>{{disc.trackList.length}} </b>
                                    碟片时长: <b>{{disc.discLength}}</b>
                                </p>
                            </div>
                        </p-fieldset>
                        <p-fieldset :toggleable="true" class="mt-2">
                            <template #legend>
                                <i class="pi iconfont icon-miaoshu mr-2" style="font-size: 2rem"></i>
                                <b>描述</b>
                            </template>
                            <article id="description" class="markdown-body" style="width: 100%;"></article>
                        </p-fieldset>
                        <p-fieldset :toggleable="true" class="mt-2">
                            <template #legend>
                                <i class="pi iconfont icon-gift mr-2" style="font-size: 2rem"></i>
                                <b>特典</b>
                            </template>
                            <article id="bonus" class="markdown-body" style="width: 100%;"></article>
                        </p-fieldset>
                        <p-fieldset :toggleable="true" class="mt-2">
                            <template #legend>
                                <i class="pi pi-images mr-2" style="font-size: 2rem"></i>
                                <b>图片</b>
                            </template>
                            <div v-if="album.displayImages.length == 0">
                                <span class="emptyInfo"><em>暂无图片</em></span>
                            </div>
                            <div v-else align="center">
                                <p-inplace>
                                    <template #display>
                                        <span class="pi pi-eye" style="vertical-align: middle"></span>
                                        <span style="margin-left:.5rem; vertical-align: middle">加载图片</span>
                                    </template>
                                    <template #content>
                                        <p-galleria :value="album.displayImages" :responsive-options="responsiveOptions"
                                                    :num-visible="5" container-style="width: 600px" :circular="true">
                                            <template #item="{item}">
                                                <div id="galleria-div">
                                                    <img :class="galleriaItemClass" :src="item.url" :alt="item.name"
                                                         :onload="initImageClass(item.url)"/>
                                                </div>
                                            </template>
                                            <template #caption="{item}">
                                                <div class="custom-galleria-footer">
                                            <span v-if="album.displayImages" class="title-container">
                                                <span>共{{album.displayImages.length}}张</span>
                                                <span class="title">{{item.nameZh}}</span>
                                                <span>{{item.description}}</span>
                                            </span>
                                                </div>
                                            </template>
                                            <template #thumbnail="{item}">
                                                <div class="grid grid-nogutter justify-content-center">
                                                    <img id="galleria-item" :src="item.thumbUrl" :alt="item.name"
                                                         class="galleria-thumb-image"/>
                                                </div>
                                            </template>
                                        </p-galleria>
                                    </template>
                                </p-inplace>
                            </div>
                        </p-fieldset>
                    </div>
                    <div class="col-12 sm:col-12 md:col-6 lg:col-3">
                        <p-panel>
                            <template #header>
                                <i class="pi iconfont icon-product_b mr-2" style="font-size: 2rem"></i>
                                <b>专辑分类</b>
                            </template>
                            <div class="grid">
                                <div class="col-fixed">
                                    <i class="pi pi-bookmark mr-2"></i><b>所属系列</b>
                                </div>
                                <div class="col-10 col-offset-1">
                                    {{album.series.name}}
                                </div>
                                <div class="col-fixed">
                                    <i class="pi pi-tags mr-2"></i><b>所属作品</b>
                                </div>
                                <div class="col-10 col-offset-1">
                                    <p class="mb-0" v-for="item of album.products">
                                        <a :href="'/db/product/'+ item.id ">
                                            <span class="albumtitle" lang="en" style="display:inline">
                                                {{item.name}}
                                            </span>
                                        </a>
                                    </p>
                                </div>
                            </div>
                        </p-panel>
                        <br>
                        <p-panel>
                            <template #header>
                                <i class="pi iconfont icon-album mr-2" style="font-size: 2rem"></i>
                                <b>相关专辑</b>
                            </template>
                            <div class="grid">
                                <span class="small_font">
                                    <div class="info_bit_small small_font ml-0 grid"
                                         v-if="relatedAlbums.length != 0"
                                         v-for="relatedAlbum of relatedAlbums">
                                        <div class="col-3 sidebar-panel-image-small-div mt-2">
                                            <a :href="'/db/album/'+ relatedAlbum.id ">
                                                <img class="sidebar-panel-image-small" :src="relatedAlbum.cover.url"
                                                     style="border-radius: 20%;"
                                                     v-tooltip.bottom="'收录时间: ' + relatedAlbum.addedTime + '编辑时间: ' + relatedAlbum.editedTime">
                                            </a>
                                        </div>
                                        <div class="col-9">
                                            <ul class="info_bit_small">
                                            <li>
                                                <a class="small_font"
                                                   :href="'/db/album/'+ relatedAlbum.id ">
                                                    <span class="text-truncate-2" lang="ja">
                                                        {{relatedAlbum.nameJp}}
                                                    </span>
                                                </a>
                                            </li>
                                            <li>
                                                <span class="small_font">
                                                    <b>{{relatedAlbum.catalogNo}}</b> {{relatedAlbum.releaseDate}}
                                                </span>
                                            </li>

                                        </ul>
                                        </div>
                                    </div>
                                </span>
                                <br>
                                <b class="rbot"><b></b></b>
                            </div>
                        </p-panel>
                        <br>
                        <p-panel>
                            <template #header>
                                <i class="pi pi-images mr-2" style="font-size: 2rem"></i>
                                <b>图片</b>
                            </template>
                            <div v-if="album.displayImages.length == 0">
                                <span class="emptyInfo"><em>暂无图片</em></span>
                            </div>
                            <p-galleria v-if="album.displayImages" :value="album.displayImages"
                                        v-model:active-index="activeIndex" :responsive-options="responsiveOptions"
                                        :num-visible="7" container-style="max-width: 800px"
                                        :circular="true" :full-screen="true" :show-item-navigators="true"
                                        :show-thumbnails="false" v-model:visible="displayCustom">
                                <template #item="{item}">
                                    <img :class="initGalleriaImageClass(item.url)" :src="item.url" :alt="item.name"
                                         oncontextmenu="return false"/>
                                </template>
                                <template #caption="{item}">
                                    <div class="custom-galleria-footer">
                                        <div class="col-6">
                                            <span v-if="album.displayImages" class="title-container">
                                                <span>共{{album.displayImages.length}}张</span>
                                                <span class="title">{{item.nameZh}}</span>
                                                <span>{{item.description}}</span>
                                            </span>
                                        </div>
                                        <div class="col-6 text-end">
                                            <span v-if="album.displayImages">
                                            <span>上传于 {{item.uploadTime}}</span>
                                        </span>
                                        </div>
                                    </div>
                                </template>
                            </p-galleria>
                            <div v-if="album.displayImages" class="grid justify-content-evenly justify-content-start">
                                <div class="col-4 mt-2 mb-2" id="panel-image-div"
                                     v-for="(image, index) of album.displayImages" :key="index">
                                    <img :class="getSidebarPanelImageClass(image.thumbUrl)" :src="image.thumbUrl"
                                         draggable="false"
                                         oncontextmenu="return false"
                                         v-tooltip.bottom="{value: '上传时间: ' + image.uploadTime, class: 'time-tooltip'}"
                                         @click="imageClick(index)"/>
                                </div>
                            </div>
                            <br>
                            <b class="rbot"><b></b></b>
                        </p-panel>
                        <br>
                        <p-panel>
                            <template #header>
                                <i class="pi pi-info-circle mr-2" style="font-size: 2rem"></i>
                                <b>页面信息</b>
                            </template>
                            <div class="grid">
                                <div class="col-fixed">
                                    <i class="pi pi-plus mr-2"></i><b>录入时间</b>
                                </div>
                                <div class="col-10 col-offset-1">
                                    {{album.addedTime}}
                                </div>
                                <div class="col-fixed">
                                    <i class="pi pi-pencil mr-2"></i><b>编辑时间</b>
                                </div>
                                <div class="col-10 col-offset-1">
                                    {{album.editedTime}}
                                </div>
                                <div class="col-fixed">
                                    <i class="pi pi-chart-bar mr-2"></i><b>页面流量</b>
                                </div>
                                <div class="col-10 col-offset-1">
                                    <i class="pi pi-eye mr-2"></i><b>访问数：</b>
                                    <span class="text-center">{{visitNum}}</span>
                                </div>
                            </div>
                        </p-panel>
                    </div>
                </div>
                <p-dialog v-model:visible="displayEditDialog" header="编辑专辑基础信息"
                          :style="{width: '800px'}" :modal="true" class="p-fluid">
                    <div class="formgrid grid">
                        <div class="field col">
                            <label htmlFor="nameJp">专辑名称<span style="color: red">*</span></label>
                            <p-inputtext id="nameJp" v-model.trim="albumEdit.nameJp"></p-inputtext>
                        </div>
                        <div class="field col">
                            <label htmlFor="nameEn">专辑名称(英语)</label>
                            <p-inputtext id="nameEn" v-model.trim="albumEdit.nameEn"></p-inputtext>
                        </div>
                        <div class="field col">
                            <label htmlFor="nameZh">专辑名称(中文)</label>
                            <p-inputtext id="nameZh" v-model.trim="albumEdit.nameZh"></p-inputtext>
                        </div>
                    </div>
                    <div class="formgrid grid">
                        <div class="field col">
                            <label htmlFor="catalogNo">专辑编号</label>
                            <p-inputtext id="catalogNo" v-model.trim="albumEdit.catalogNo"></p-inputtext>
                        </div>
                        <div class="field col">
                            <label htmlFor="barcode">商品条形码</label>
                            <p-inputtext id="barcode" v-model.trim="albumEdit.barcode"></p-inputtext>
                        </div>
                    </div>
                    <div class="formgrid grid">
                        <div class="field col">
                            <label htmlFor="releaseDate">发行时间<span style="color: red">*</span></label>
                            <p-calendar id="releaseDate" v-model="albumEdit.releaseDate" date-format="yy/mm/dd"
                                        :show-button-bar="true"
                                        :show-icon="true"></p-calendar>
                        </div>
                        <div class="field col">
                            <label htmlFor="publishPrice">发行价格(含税)</label>
                            <p-inputnumber id="publishPrice" v-model="albumEdit.publishPrice" mode="currency"
                                           currency="JPY"
                                           locale="ja-JP"></p-inputnumber>
                        </div>
                    </div>
                    <div class="formgrid grid">
                        <div class="field col">
                            <label htmlFor="seriesId" class="mb-3">所属系列<span style="color: red">*</span></label>
                            <p-dropdown id="seriesId" v-model="albumEdit.series" :options="seriesSet"
                                        option-label="label" option-value="value"
                                        :disabled="seriesBool">
                            </p-dropdown>
                        </div>
                        <div class="field col">
                            <label htmlFor="products" class="mb-3">所属产品<span style="color: red">*</span></label>
                            <p-multiselect id="products" v-model="albumEdit.products" :options="productSet"
                                           option-label="label" option-value="value" placeholder="选择所属产品"
                                           display="chip" :filter="true">
                            </p-multiselect>
                        </div>
                        <div class="field col">
                            <div class="col-12">
                                <label htmlFor="hasBonus" class="mb-3">特典</label>
                            </div>
                            <div class="col-12 mt-2">
                                <p-inputswitch v-model="albumEdit.hasBonus" :true-value="1"
                                               :false-value="0"></p-inputswitch>
                            </div>
                        </div>
                    </div>
                    <div class="formgrid grid">
                        <div class="field col">
                            <label htmlFor="publishFormat" class="mb-3">出版形式<span
                                    style="color: red">*</span></label>
                            <p-multiselect id="publishFormat" v-model="albumEdit.publishFormat"
                                           :options="publishFormatSet"
                                           option-label="label" option-value="value" placeholder="选择出版形式"
                                           display="chip">
                            </p-multiselect>
                        </div>
                        <div class="field col">
                            <label htmlFor="albumFormat" class="mb-3">专辑分类<span style="color: red">*</span></label>
                            <p-multiselect id="albumFormat" v-model="albumEdit.albumFormat" :options="albumFormatSet"
                                           option-label="label" option-value="value" placeholder="选择专辑分类"
                                           display="chip">
                            </p-multiselect>
                        </div>
                        <div class="field col">
                            <label htmlFor="mediaFormat" class="mb-3">媒体类型<span style="color: red">*</span></label>
                            <p-multiselect id="mediaFormat" v-model="albumEdit.mediaFormat" :options="mediaFormatSet"
                                           option-label="label" option-value="value" placeholder="选择媒体类型"
                                           display="chip">
                            </p-multiselect>
                        </div>
                    </div>
                    <div class="formgrid grid">
                        <div class="field col">
                            <label htmlFor="label">唱片公司</label>
                            <p-inputtext id="label" v-model.trim="albumEdit.label"></p-inputtext>
                        </div>
                        <div class="field col">
                            <label htmlFor="publisher">发行商</label>
                            <p-inputtext id="publisher" v-model.trim="albumEdit.publisher"></p-inputtext>
                        </div>
                        <div class="field col">
                            <label htmlFor="distributor">经销商</label>
                            <p-inputtext id="distributor" v-model.trim="albumEdit.distributor"></p-inputtext>
                        </div>
                        <div class="field col">
                            <label htmlFor="copyright">版权方</label>
                            <p-inputtext id="copyright" v-model.trim="albumEdit.copyright"></p-inputtext>
                        </div>
                    </div>
                    <div class="field">
                        <label htmlFor="remark">备注</label>
                        <p-textarea id="remark" v-model="albumEdit.remark" rows="3" cols="20"
                                    :auto-resize="true"></p-textarea>
                    </div>
                    <template #footer>
                        <p-button label="取消" icon="pi pi-times" class="p-button-text"
                                  @click="closeEditDialog"></p-button>
                        <p-button label="保存" icon="pi pi-check" class="p-button-text"
                                  @click="submitEditAlbum"></p-button>
                    </template>
                </p-dialog>
                <p-dialog v-model:visible="displayImageEditDialog" header="图片管理"
                          :style="{width: '1200px'}" :modal="true">
                    <p-panel>
                        <template #header>
                            <i class="pi pi-plus-circle mr-2" style="font-size: 2rem"></i>
                            <b>新增</b>
                        </template>
                        <div class="grid">
                            <div class="col-6" align="left">
                                <p-fileupload
                                        mode="basic"
                                        :custom-upload="true"
                                        accept="image/*"
                                        :auto="true"
                                        choose-label="上传图片"
                                        :max-file-size="10000000" :preview-width="100"
                                        invalid-file-size-message="{0}大小已超过{1}"
                                        @uploader="onUpload"
                                        @select="selectFile">
                                </p-fileupload>
                            </div>
                            <div class="col-6" align="right">
                                <p-button class="ml-2 p-button-text" icon="pi pi-trash"
                                          label="清空所选" @click="clearUploadedImage"></p-button>
                            </div>
                        </div>
                        <div class="formgrid grid mt-2">
                            <div class="field col">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-image"></i>
                                    </span>
                                    <p-inputtext v-model="imageInfo.nameZh" placeholder="图片名(中)"></p-inputtext>
                                </div>
                            </div>
                            <div class="field col">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-image"></i>
                                    </span>
                                    <p-inputtext v-model="imageInfo.nameEn" placeholder="图片名(英)"></p-inputtext>
                                </div>
                            </div>
                            <div class="field col">
                                <p-dropdown v-model="imageInfo.type" :options="imageTypes" option-label="label"
                                            option-value="value" placeholder="选择图片类型"
                                            style="width: 280px"></p-dropdown>
                            </div>
                            <div class="field col">
                                <p-textarea v-model="imageInfo.description" rows="1" cols="20"
                                            :auto-resize="true" placeholder="图片描述"
                                            style="width: 280px"></p-textarea>
                            </div>
                        </div>
                        <div class="formgrid grid mt-2">
                            <div class="field col" align="left">
                                <p-button label="新增图片" icon="pi pi-save"
                                          @click="save2imageInfos"></p-button>
                            </div>
                            <div class="field col" align="right">
                                <p-button label="提交新增" icon="pi pi-save"
                                          @click="submitImages" class="p-button-success"></p-button>
                            </div>
                        </div>
                        <p-divider></p-divider>
                        <div class="field">
                            <span v-if=" imageHtml == '' " class="emptyInfo">还未选择图片</span>
                            <section>
                                <div id="imgBox" v-html="imageHtml"></div>
                            </section>
                        </div>
                    </p-panel>
                    <p-panel>
                        <template #header>
                            <i class="pi pi-pencil mr-2" style="font-size: 2rem"></i>
                            <b>编辑</b>
                        </template>
                        <div v-if="album.images.length != 0">
                            <p-datatable :value="album.images" class="p-datatable-sm"
                                         @row-reorder="imgRowReorder" edit-mode="row" striped-rows
                                         :resizable-columns="true" column-resize-mode="expand"
                                         v-model:editing-rows="editingImages" @row-edit-save="imgRowEditSave"
                                         v-model:selection="selectedImage">
                                <template #header>
                                    <p-button icon="pi pi-trash" class="p-button-danger"
                                              @click="confirmDeleteSelectedImage"></p-button>
                                </template>
                                <p-column selection-mode="multiple" header-style="width: 4%"></p-column>
                                <p-column :row-reorder="true" header-style="width: 3%"></p-column>
                                <p-column header="图片" header-style="width: 8%">
                                    <template #body="slotProps">
                                        <img :src="slotProps.data.thumbUrl" :alt="slotProps.data.nameEn"
                                             class="edit-image"/>
                                    </template>
                                </p-column>
                                <p-column field="url" header="url" header-style="width: 10%"></p-column>
                                <p-column field="nameZh" header="名(中)" header-style="width: 10%">
                                    <template #editor="{ data, field }">
                                        <p-inputtext v-model="data[field]" autofocus style="width: 100px"></p-inputtext>
                                    </template>
                                </p-column>
                                <p-column field="nameEn" header="名(英)" header-style="width: 10%">
                                    <template #editor="{ data, field }">
                                        <p-inputtext v-model="data[field]" autofocus style="width: 100px"></p-inputtext>
                                    </template>
                                </p-column>
                                <p-column field="type" header="类型" header-style="width: 8%">
                                    <template #editor="{ data, field }">
                                        <p-dropdown v-model="data[field]" :options="imageTypes" option-label="label"
                                                    option-value="value" placeholder="图片类型">

                                        </p-dropdown>
                                    </template>
                                    <template #body="slotProps">
                                        {{getImageTypeLabel(slotProps.data.type)}}
                                    </template>
                                </p-column>
                                <p-column field="description" header="描述" header-style="width: 15%">
                                    <template #editor="{ data, field }">
                                        <p-inputtext v-model="data[field]" autofocus style="width: 100px"></p-inputtext>
                                    </template>
                                </p-column>
                                <p-column field="uploadTime" header="上传时间" header-style="width: 10%"></p-column>
                                <p-column :row-editor="true" header-style="width: 15%"></p-column>
                            </p-datatable>
                        </div>
                        <div v-else>
                            <span class="emptyInfo"><em>暂无图片</em></span>
                        </div>
                    </p-panel>
                    <template #footer>
                        <p-button icon="pi pi-times" label="取消" @click="closeImageEditDialog"
                                  class="p-button-text"></p-button>
                        <p-button icon="pi pi-save" label="提交更新" @click="updateImage"></p-button>
                    </template>
                </p-dialog>
                <p-dialog v-model:visible="displayArtistEditDialog" header="编辑创作者信息"
                          :style="{width: '800px'}" :modal="true">
                    <p-panel>
                        <template #header>
                            <i class="pi pi-user-plus mr-2" style="font-size: 2rem"></i>
                            <b>新增</b>
                        </template>
                        <div class="grid">
                            <div class="col-3">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-tag"></i>
                                    </span>
                                    <p-inputtext v-model="artist.pos" placeholder="职位名称"></p-inputtext>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-users"></i>
                                    </span>
                                    <p-chips v-model="artist.name" placeholder="人员信息" separator=","></p-chips>
                                </div>
                            </div>
                            <div class="col-2">
                                <p-button label="新增" icon="pi pi-save"
                                          @click="addArtist"></p-button>
                            </div>
                        </div>
                    </p-panel>
                    <p-panel>
                        <template #header>
                            <i class="pi pi-user-edit mr-2" style="font-size: 2rem"></i>
                            <b>编辑</b>
                        </template>
                        <div v-if="tmpArtists.length != 0">
                            <p-datatable dataKey="id" :value="tmpArtists" responsive-layout="scroll"
                                         class="p-datatable-sm" striped-rows @row-reorder="onRowReorder"
                                         context-menu v-model:context-menu-selection="selectedArtist"
                                         @row-contextmenu="artistRowMenu" edit-mode="row"
                                         v-model:editing-rows="editingRows" @row-edit-save="onRowEditSave">
                                <p-column :row-reorder="true"></p-column>
                                <p-column field="pos" header="职位">
                                    <template #editor="{ data, field }">
                                        <p-inputtext v-model="data[field]" autofocus></p-inputtext>
                                    </template>
                                </p-column>
                                <p-column field="name" header="人员">
                                    <template #body="slotProps">
                                        {{slotProps.data.name.join(" / ")}}
                                    </template>
                                    <template #editor="{ data, field }">
                                        <p-chips v-model="data[field]"></p-chips>
                                    </template>
                                </p-column>
                                <p-column :row-editor="true" style="width:10%; min-width:8rem"
                                          bodyStyle="text-align:center"></p-column>
                            </p-datatable>
                            <p-contextmenu :model="menuModel" ref="cm"></p-contextmenu>
                        </div>
                        <div v-else>
                            <span class="emptyInfo">暂无创作者相关信息</span>
                        </div>
                    </p-panel>
                    <template #footer>
                        <p-button label="清空" icon="pi pi-trash" class="p-button-danger mr-4"
                                  @click="clearArtists"></p-button>
                        <p-button label="取消" icon="pi pi-times" class="mr-4"
                                  @click="cancelArtistEdit"></p-button>
                        <p-button label="更新" icon="pi pi-save" class="p-button-success mr-4"
                                  @click="submitArtist"></p-button>
                    </template>
                </p-dialog>
                <p-dialog v-model:visible="displayTrackEditDialog" header="编辑音轨信息"
                          :style="{width: '800px'}" :modal="true">
                    <p-panel>
                        <template #header>
                            <i class="pi pi-plus-circle mr-2" style="font-size: 2rem"></i>
                            <b>新增</b>
                        </template>
                        <div class="grid">
                            <div class="col-10">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-tag"></i>
                                    </span>
                                    <p-chips v-model="tracks.audioNames" placeholder="曲目列表" separator=","></p-chips>
                                </div>
                            </div>
                            <div class="col-10">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-users"></i>
                                    </span>
                                    <p-chips v-model="tracks.audioLengths" placeholder="曲目长度"
                                             separator=","></p-chips>
                                </div>
                            </div>

                            <div class="col-5">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-tag"></i>
                                    </span>
                                    <p-multiselect id="mediaFormat" v-model="disc.mediaFormat" :options="mediaFormatSet"
                                                   option-label="label" option-value="labelEn" placeholder="媒体格式"
                                                   display="chip">
                                    </p-multiselect>
                                </div>
                            </div>
                            <div class="col-5">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-tag"></i>
                                    </span>
                                    <p-multiselect id="albumFormat" v-model="disc.albumFormat" :options="albumFormatSet"
                                                   option-label="label" option-value="labelEn" placeholder="专辑分类"
                                                   display="chip">
                                    </p-multiselect>
                                </div>
                            </div>

                            <div class="col-2">
                                <p-button label="添加碟片" icon="pi pi-save" class="p-button-success"
                                          @click="addDisc"></p-button>
                            </div>
                        </div>
                    </p-panel>
                    <p-panel>
                        <template #header>
                            <i class="pi pi-pencil mr-2" style="font-size: 2rem"></i>
                            <b>编辑</b>
                        </template>
                        <div v-if="tmpEditDiscList.length != 0">
                            <p-datatable :value="tmpEditDiscList" class="p-datatable-sm" striped-rows
                                         responsive-layout="scroll" v-model:expanded-rows="expandedRows"
                                         @row-reorder="onRowReorderDisc"
                                         context-menu v-model:context-menu-selection="selectedDisc"
                                         @row-contextmenu="discRowMenu" edit-mode="row"
                                         v-model:editing-rows="editingRowsDisc" @row-edit-save="onRowEditSaveDisc">
                                <template #header>
                                    <div class="table-header-container">
                                        <p-button icon="pi pi-plus" label="全部展开" @click="expandAll"
                                                  class="mr-2"></p-button>
                                        <p-button icon="pi pi-minus" label="全部折叠" @click="collapseAll"></p-button>
                                    </div>
                                </template>
                                <p-column :row-reorder="true"></p-column>
                                <p-column :expander="true" headerStyle="width: 3rem"></p-column>
                                <p-column header="碟片序号">
                                    <template #body="slotProps">
                                        {{slotProps.index+1}}
                                    </template>
                                </p-column>
                                <p-column field="albumFormat" header="专辑分类">
                                    <template #body="slotProps">
                                        {{slotProps.data.albumFormat.join("/")}}
                                    </template>
                                    <template #editor="{ data, field }">
                                        <p-multiselect v-model="data[field]" :options="albumFormatSet"
                                                       option-label="label" option-value="labelEn"
                                                       placeholder="专辑分类"
                                                       display="chip">
                                        </p-multiselect>
                                    </template>
                                </p-column>
                                <p-column field="mediaFormat" header="媒体格式">
                                    <template #body="slotProps">
                                        {{slotProps.data.mediaFormat.join("/")}}
                                    </template>
                                    <template #editor="{ data, field }">
                                        <p-multiselect v-model="data[field]" :options="mediaFormatSet"
                                                       option-label="label" option-value="labelEn"
                                                       placeholder="媒体格式"
                                                       display="chip">
                                        </p-multiselect>
                                    </template>
                                </p-column>
                                <p-column :row-editor="true" style="width:10%; min-width:8rem"
                                          bodyStyle="text-align:center"></p-column>
                                <template #expansion="slotProps">
                                    <div class="orders-subtable">
                                        <p-datatable :value="slotProps.data.trackList" class="p-datatable-sm"
                                                     striped-rows
                                                     responsive-layout="scroll"
                                                     @row-reorder="onRowReorderTrack"
                                                     context-menu v-model:context-menu-selection="selectedTrack"
                                                     @row-contextmenu="trackRowMenu" edit-mode="row"
                                                     v-model:editing-rows="editingRowsTrack"
                                                     @row-edit-save="onRowEditSaveTrack">
                                            <p-column :row-reorder="true"></p-column>
                                            <p-column header="曲目序号">
                                                <template #body="slotProps">
                                                    {{slotProps.index+1}}
                                                </template>
                                            </p-column>
                                            <p-column field="musicId" header="曲目编号" sortable></p-column>
                                            <p-column field="name" header="曲名">
                                                <template #editor="{ data, field }">
                                                    <p-inputtext v-model="data[field]" autofocus></p-inputtext>
                                                </template>
                                            </p-column>
                                            <p-column field="length" header="音频长度">
                                                <template #editor="{ data, field }">
                                                    <p-inputtext v-model="data[field]" autofocus></p-inputtext>
                                                </template>
                                            </p-column>
                                            <p-column :row-editor="true" style="width:10%; min-width:8rem"
                                                      bodyStyle="text-align:center"></p-column>
                                            <p-contextmenu :model="menuModelTrack" ref="cmTrack"></p-contextmenu>
                                        </p-datatable>
                                    </div>
                                </template>
                                <p-contextmenu :model="menuModelDisc" ref="cmDisc"></p-contextmenu>
                            </p-datatable>
                        </div>
                        <div v-else>
                            <span class="emptyInfo">暂无音轨信息</span>
                        </div>
                    </p-panel>
                    <template #footer>
                        <p-button label="保存" icon="pi pi-save" class="p-button-success mr-4"
                                  @click="submitTrackInfo"></p-button>
                    </template>
                </p-dialog>
                <p-dialog v-model:visible="displayDescriptionDialog" header="编辑描述信息"
                          :breakpoints="{'960px': '75vw', '640px': '90vw'}" :style="{width: '80vw'}" :modal="true">
                    <!--                    <div id="md-editor-v3">-->
                    <md-editor-v3 v-model="descriptionMd" preview-theme="github">
                    </md-editor-v3>
                    <!--                    </div>-->
                    <template #footer>
                        <p-button label="取消" icon="pi pi-times" @click="closeDescriptionEditDialog"
                                  class="p-button-text">
                        </p-button>
                        <p-button label="保存" icon="pi pi-save" @click="submitDescription" autofocus></p-button>
                    </template>
                </p-dialog>
                <p-dialog v-model:visible="displayBonusDialog" header="编辑特典信息"
                          :breakpoints="{'960px': '75vw', '640px': '90vw'}" :style="{width: '80vw'}" :modal="true">
                    <md-editor-v3 v-model="bonusMd" preview-theme="github"></md-editor-v3>
                    <template #footer>
                        <p-button label="取消" icon="pi pi-times" @click="closeBonusEditDialog" class="p-button-text">
                        </p-button>
                        <p-button label="保存" icon="pi pi-save" @click="submitBonus"></p-button>
                    </template>
                </p-dialog>
                <p-dialog v-model:visible="deleteAlbumImageDialog" header="删除图片"
                          :breakpoints="{'960px': '75vw', '640px': '90vw'}" :style="{width: '50vw'}" :modal="true">
                    <div class="confirmation-content">
                        <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
                        <span v-if="album">确定删除所选的图片？</span>
                    </div>
                    <template #footer>
                        <p-button label="取消" icon="pi pi-times" class="p-button-text"
                                  @click="cancelDeleteSelectedImage"></p-button>
                        <p-button label="确认删除" icon="pi pi-check" class="p-button-text"
                                  @click="deleteImage"></p-button>
                    </template>
                </p-dialog>

                <!-- 尾部 -->
                <footer class="mt-2" th:insert="~{template/footer :: site_footer}"></footer>
            </div>
        </div>
    </div>
</div>
<script type="module" th:inline="javascript">

    const {createApp, onMounted, ref} = Vue;
    const Tooltip = primevue.tooltip;
    const {useToast} = primevue.usetoast;

    const App = {
        setup() {
            onMounted(() => {
                init();
            })

            const album = ref([[${album}]]);
            const visitNum = ref([[${visitNum}]]);
            const relatedAlbums = ref([[${relatedAlbums}]]);
            const toast = useToast();
            const edits = ref([
                {
                    label: '图片管理',
                    icon: 'pi pi-images',
                    command: () => {
                        openImageEditDialog();
                    }
                },
                {
                    label: '音乐制作',
                    icon: 'pi pi-users',
                    command: () => {
                        openArtistEditDialog();
                    }
                },
                {
                    label: '音轨信息',
                    icon: 'pi iconfont icon-playlist',
                    command: () => {
                        openTrackEditDialog();
                    }
                },
                {
                    label: '描述信息',
                    icon: 'pi iconfont icon-miaoshu',
                    command: () => {
                        openDescriptionEditDialog();
                    }
                },
                {
                    label: '特典信息',
                    icon: 'pi iconfont icon-gift',
                    command: () => {
                        openBonusEditDialog();
                    }
                }
            ]);
            const mediaFormatSet = ref([[${mediaFormatSet}]]);
            const albumFormatSet = ref([[${albumFormatSet}]]);
            const publishFormatSet = ref([[${publishFormatSet}]]);
            const productSet = ref([[${productSet}]]);
            const seriesSet = ref([[${seriesSet}]]);

            //region ------图片板块------
            const imgRowReorder = (ev) => {
                album.value.images = ev.value;
            };
            const editingImages = ref([]);
            const imgRowEditSave = (ev) => {
                let {newData, index} = ev;
                album.value.images[index] = newData;
            };
            const getImageTypeLabel = (type) => {
                return value2Label(type, imageTypes.value);
            }
            const activeIndex = ref(0);
            const displayCustom = ref(false);
            const imageClick = (index) => {
                activeIndex.value = index;
                displayCustom.value = true;
            };
            //endregion

            //region ------编辑专辑信息------
            const seriesBool = true;
            const albumEdit = ref({});
            const displayEditDialog = ref(false);

            //打开编辑数据面板
            const openEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state == 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            let dataTmp = JSON.parse(JSON.stringify(album.value));
                            dataTmp.mediaFormat = album.value.mediaFormat.split("/");
                            dataTmp.albumFormat = album.value.albumFormat.split("/");
                            dataTmp.publishFormat = album.value.publishFormat.split("/");
                            albumEdit.value = dataTmp;
                            albumEdit.value.mediaFormat = label2value(dataTmp.mediaFormat, mediaFormatSet.value).concat();
                            albumEdit.value.albumFormat = label2value(dataTmp.albumFormat, albumFormatSet.value).concat();
                            albumEdit.value.publishFormat = label2value(dataTmp.publishFormat, publishFormatSet.value).concat();
                            albumEdit.value.products = label2value(dataTmp.product, productSet.value).concat();
                            albumEdit.value.series = dataTmp.series.id;
                            displayEditDialog.value = true;
                        }
                    })
            };

            //关闭编辑数据面板
            const closeEditDialog = () => {
                displayEditDialog.value = false;
                albumEdit.value = {};
            };

            //保存编辑数据
            const submitEditAlbum = () => {
                axiosPostRequest(UPDATE_ALBUM_URL, albumEdit.value)
                    .then(res => {
                        if (res.state === 1) {
                            albumEdit.value = {};
                            toast.add({
                                severity: 'success',
                                summary: 'Successful',
                                detail: res.message,
                                life: 3000
                            });
                            closeEditDialog();
                            location.reload(true);
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    })
                    .catch(error => {
                        console.error(error);
                    });
            };
            //endregion

            //region ------编辑描述------
            const descriptionMd = ref("");
            const displayDescriptionDialog = ref(false);
            const openDescriptionEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state == 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            descriptionMd.value = album.value.description;
                            displayDescriptionDialog.value = true;
                        }
                    });
            }
            const closeDescriptionEditDialog = () => {
                displayDescriptionDialog.value = false;
                descriptionMd.value = "";
            }
            const submitDescription = () => {
                let json = {
                    id: album.value.id,
                    description: descriptionMd.value
                }
                axiosPostRequest(UPDATE_ALBUM_DESCRIPTION_URL, json)
                    .then(res => {
                        if (res.state != 0) {
                            album.value.description = descriptionMd.value;
                            text2marked();
                            closeDescriptionEditDialog();
                            toast.add({severity: 'success', summary: 'Successful', detail: res.message, life: 3000});
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    });
            }
            //endregion

            //region ------编辑特典------
            const bonusMd = ref("");
            const displayBonusDialog = ref(false);
            const openBonusEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state == 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            bonusMd.value = album.value.bonus;
                            displayBonusDialog.value = true;
                        }
                    });
            }
            const closeBonusEditDialog = () => {
                displayBonusDialog.value = false;
                bonusMd.value = "";
            }
            const submitBonus = () => {
                let json = {
                    id: album.value.id,
                    bonus: bonusMd.value
                }
                axiosPostRequest(UPDATE_ALBUM_BONUS_URL, json)
                    .then(res => {
                        if (res.state != 0) {
                            album.value.bonus = bonusMd.value;
                            text2marked();
                            closeBonusEditDialog();
                            toast.add({severity: 'success', summary: 'Successful', detail: res.message, life: 3000});
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    });
            };
            //endregion

            //region ------markdown共通------

            const text2marked = () => {

                const description = album.value.description;
                const bonus = album.value.bonus;

                if (description != null && description !== "") {
                    document.getElementById("description").innerHTML = marked.parse(description);
                } else {
                    //<![CDATA[
                    document.getElementById("description").innerHTML = "<span class='emptyInfo'><em>暂无描述</em></span>";
                    //]]>
                }

                if (bonus != null && bonus !== "") {
                    document.getElementById("bonus").innerHTML = marked.parse(bonus);
                } else {
                    //<![CDATA[
                    document.getElementById("bonus").innerHTML = "<span class='emptyInfo'><em>暂无特典信息</em></span>";
                    //]]>
                }
            };
            //endregion

            //region ------音轨信息相关组件------
            let tmpDiscId = 1000;
            let tmpTrackId = 1000;
            const tmpEditDiscList = ref();
            const cmDisc = ref();
            const cmTrack = ref();
            const selectedDisc = ref();
            const selectedTrack = ref();
            const menuModelDisc = ref([
                {label: '删除', icon: 'pi pi-fw pi-trash', command: () => deleteDisc(selectedDisc)}
            ]);
            const menuModelTrack = ref([
                {label: '删除', icon: 'pi pi-fw pi-trash', command: () => deleteTrack(selectedTrack)}
            ]);
            const onRowReorderDisc = (ev) => {
                tmpEditDiscList.value = ev.value;
            };
            const onRowReorderTrack = (ev) => {

                for (let disc of tmpEditDiscList.value) {
                    if (disc.tmpDiscId === ev.value[0].tmpDiscId) {
                        disc.trackList = ev.value;
                    }
                }
            };
            const discRowMenu = (ev) => {
                cmDisc.value.show(ev.originalEvent);
            };
            const trackRowMenu = (ev) => {
                cmTrack.value.show(ev.originalEvent);
            };
            const deleteDisc = (disc) => {
                tmpEditDiscList.value = tmpEditDiscList.value.filter((d) => d.tmpDiscId !== disc.value.tmpDiscId);
                toast.add({severity: 'error', summary: '已删除', detail: disc.value.tmpDiscId, life: 3000});
                selectedArtist.value = null;
            };
            const deleteTrack = (track) => {
                for (let disc of tmpEditDiscList.value) {
                    if (disc.tmpDiscId === track.value.tmpDiscId) {
                        disc.trackList = disc.trackList.filter((t) => t.tmpTrackId !== track.value.tmpTrackId);
                    }
                }
                toast.add({severity: 'error', summary: '已删除', detail: track.value.name, life: 3000});
            };
            const editingRowsDisc = ref([]);
            const editingRowsTrack = ref([]);
            const onRowEditSaveDisc = (ev) => {
                let {newData, index} = ev;
                tmpEditDiscList.value[index] = newData;
            };
            const onRowEditSaveTrack = (ev) => {
                let {newData, index} = ev;

                for (let disc of tmpEditDiscList.value) {
                    if (disc.tmpDiscId === newData.tmpDiscId) {
                        disc.trackList[index] = newData;
                    }
                }
            };

            const tracks = ref({
                audioNames: [],
                audioLengths: []
            });
            const disc = ref({
                albumFormat: [],
                mediaFormat: []
            });
            const expandedRows = ref([]);
            const expandAll = () => {
                expandedRows.value = tmpEditDiscList.value;
            };
            const collapseAll = () => {
                expandedRows.value = null;
            };
            const displayTrackEditDialog = ref(false);

            const openTrackEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state === 1) {

                            tmpEditDiscList.value = JSON.parse(JSON.stringify(album.value.editDiscList));

                            tracks.value = {};
                            disc.value = {};

                            displayTrackEditDialog.value = true;
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    });
            };
            const checkDisc = () => {
                if (tracks.value.audioNames === undefined || tracks.value.audioNames.length === 0) {
                    toast.add({
                        severity: 'error',
                        summary: 'Error',
                        detail: ALBUM_DETAIL_TRACK_INFO_MUSIC_NAME_EMPTY,
                        life: 3000
                    });
                    return false;
                }
                if (tracks.value.audioLengths === undefined || tracks.value.audioLengths.length === 0) {
                    toast.add({
                        severity: 'error',
                        summary: 'Error',
                        detail: ALBUM_DETAIL_TRACK_INFO_MUSIC_LENGTH_EMPTY,
                        life: 3000
                    });
                    return false;
                }
                if (tracks.value.audioLengths.length !== tracks.value.audioNames.length) {
                    toast.add({
                        severity: 'error',
                        summary: 'Error',
                        detail: ALBUM_DETAIL_TRACK_INFO_MUSIC_NOT_EQUALS,
                        life: 3000
                    });
                    return false;
                }
                if (disc.value.mediaFormat === undefined) {
                    toast.add({
                        severity: 'error',
                        summary: 'Error',
                        detail: ALBUM_DETAIL_TRACK_INFO_MEDIA_FORMAT_EMPTY,
                        life: 3000
                    });
                    return false;
                }
                if (disc.value.albumFormat === undefined) {
                    toast.add({
                        severity: 'error',
                        summary: 'Error',
                        detail: ALBUM_DETAIL_TRACK_INFO_ALBUM_FORMAT_EMPTY,
                        life: 3000
                    });
                    return false;
                }
                return true;
            }
            const addDisc = () => {
                if (checkDisc()) {
                    let newDisc = {
                        tmpDiscId: tmpDiscId,
                        trackList: [],
                        mediaFormat: [],
                        albumFormat: []
                    };
                    for (let i = 0; i < tracks.value.audioNames.length; i++) {
                        let track = {
                            tmpDiscId: tmpDiscId,
                            tmpTrackId: tmpTrackId,
                            musicId: 0,
                            name: null,
                            length: null
                        };
                        track.name = tracks.value.audioNames[i];
                        track.length = tracks.value.audioLengths[i];
                        newDisc.trackList.push(track);
                        tmpTrackId++;
                    }
                    newDisc.albumFormat = disc.value.albumFormat;
                    newDisc.mediaFormat = disc.value.mediaFormat;
                    tmpEditDiscList.value.push(newDisc);
                    tracks.value = {};
                    disc.value = {};
                    tmpDiscId++;
                }
            };
            const submitTrackInfo = () => {
                let json = {
                    id: album.value.id,
                    discList: tmpEditDiscList.value
                }
                axiosPostRequest(UPDATE_ALBUM_TRACK_INFO_URL, json)
                    .then(res => {
                        if (res.state !== 0) {
                            toast.add({severity: 'success', summary: 'Successful', detail: res.message, life: 3000});
                            displayTrackEditDialog.value = false;
                            location.reload(true);
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    })
            };
            //endregion

            //region ------artists相关组件------
            const tmpArtists = ref();
            const cm = ref();
            const selectedArtist = ref();
            const artist = ref({});
            const artists = ref([]);
            const displayArtistEditDialog = ref(false);
            const menuModel = ref([
                {label: '删除', icon: 'pi pi-fw pi-user-minus', command: () => deleteArtist(selectedArtist)}
            ]);
            const onRowReorder = (ev) => {
                tmpArtists.value = ev.value;
            };
            const artistRowMenu = (ev) => {
                cm.value.show(ev.originalEvent);
            };
            const deleteArtist = (artist) => {
                tmpArtists.value = tmpArtists.value.filter((a) => a.pos !== artist.value.pos);
                toast.add({severity: 'error', summary: '已删除', detail: artist.value.pos, life: 3000});
                selectedArtist.value = null;
            };
            const editingRows = ref([]);
            const onRowEditSave = (ev) => {
                let {newData, index} = ev;

                tmpArtists.value[index] = newData;
            };

            const openArtistEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state === 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            tmpArtists.value = JSON.parse(JSON.stringify(album.value.artists));
                            artist.value = {};
                            displayArtistEditDialog.value = true;
                        }
                    })
            };
            const clearArtists = () => {
                tmpArtists.value = [];
            };
            const addArtist = () => {
                tmpArtists.value.push(artist.value);
                artist.value = {};
            }
            const cancelArtistEdit = () => {
                artist.value = {};
                displayArtistEditDialog.value = false;
            };
            const submitArtist = () => {
                let json = {
                    id: album.value.id,
                    artists: tmpArtists.value
                }
                axiosPostRequest(UPDATE_ALBUM_ARTISTS_URL, json)
                    .then(res => {
                        if (res.state === 1) {
                            toast.add({severity: 'success', summary: 'Successful', detail: res.message, life: 3000});
                            displayArtistEditDialog.value = false;
                            artist.value = {};
                            location.reload(true);
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    })
            };
            //endregion

            //region ------图片相关组件------
            const updateImage = () => {
                let json = {
                    id: album.value.id,
                    images: album.value.images,
                    action: "1"
                };
                axiosPostRequest(UPDATE_ALBUM_IMAGES_URL, json)
                    .then(res => {
                        if (res.state === 1) {
                            toast.add({severity: 'success', summary: 'Success', detail: res.message, life: 3000});
                            closeImageEditDialog();
                            location.reload(true);
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    }).catch(err => {
                    console.error(err);
                });
            };
            const galleriaItemClass = ref("");

            const responsiveOptions = [
                {
                    breakpoint: '1024px',
                    numVisible: 5
                },
                {
                    breakpoint: '768px',
                    numVisible: 3
                },
                {
                    breakpoint: '560px',
                    numVisible: 1
                }
            ];
            const selectedImage = ref([]);
            const confirmDeleteSelectedImage = () => {
                deleteAlbumImageDialog.value = true;
            };
            const cancelDeleteSelectedImage = () => {
                selectedImage.value = [];
                deleteAlbumImageDialog.value = false;
            };
            const deleteAlbumImageDialog = ref(false);
            const deleteImage = () => {
                let json = {
                    id: album.value.id,
                    images: selectedImage.value,
                    action: "2"
                };
                axiosPostRequest(UPDATE_ALBUM_IMAGES_URL, json)
                    .then(res => {
                        if (res.state === 1) {
                            toast.add({severity: 'success', summary: 'Success', detail: res.message, life: 3000});
                            deleteAlbumImageDialog.value = false;
                            closeImageEditDialog();
                            selectedImage.value = [];
                            location.reload(true);
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    }).catch(err => {
                    console.error(err);
                });
            };

            const imageTypes = ref([
                {label: '展示', value: '0'},
                {label: '封面', value: '1'},
                {label: '其他', value: '2'}
            ]);
            const imageInfo = ref({
                image: null,
                nameZh: "",
                nameEn: "",
                description: "",
                type: 0
            });
            const imageInfos = ref([]);

            const displayImageEditDialog = ref(false);
            const imageHtml = ref("");
            const openImageEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state === 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            imageInfo.value = {};
                            imageInfos.value = [];
                            displayImageEditDialog.value = true;
                        }
                    })
            };
            const closeImageEditDialog = () => {
                imageInfo.value = {};
                imageInfos.value = [];
                displayImageEditDialog.value = false;
                document.getElementById("imgBox").innerHTML = "";
            };
            const showImage = () => {
                imageHtml.value = "";
                //<![CDATA[
                for (const img of imageInfos.value) {
                    imageHtml.value += '<div align=""center>';
                    imageHtml.value += '<img src="' + img.image.objectURL + '"/>';
                    imageHtml.value += '<p>图片类型: ' + (img.type === "1" ? "封面" : (img.type === "0" ? "展示" : "其他")) + '</p>';
                    imageHtml.value += '<p>图片名(中): ' + img.nameZh + '</p>';
                    imageHtml.value += '<p>图片名(英): ' + img.nameEn + '</p>';
                    imageHtml.value += '<p>描述: ' + img.description + '</p>';
                    imageHtml.value += '</div>';
                }
                //]]>
                document.getElementById("imgBox").innerHTML = imageHtml;
            };
            const selectFile = (ev) => {
                imageInfo.value.image = ev.files[0];
            };
            const onUpload = (ev) => {
                toast.add({severity: 'info', summary: 'Success', detail: IMAGE_SELECTED_INFO, life: 3000});
            };
            const checkImageInfo = () => {
                if (typeof imageInfo.value.description == "undefined") {
                    imageInfo.value.description = "";
                }
                if (imageInfo.value.image === null) {
                    toast.add({severity: 'error', summary: 'Error', detail: IMAGE_EMPTY_EXCEPTION, life: 3000});
                }
                if (typeof imageInfo.value.nameZh == "undefined") {
                    toast.add({severity: 'error', summary: 'Error', detail: IMAGE_NAME_ZH_EMPTY_EXCEPTION, life: 3000});
                    return false;
                }
                if (typeof imageInfo.value.nameEn == "undefined") {
                    toast.add({severity: 'error', summary: 'Error', detail: IMAGE_NAME_EN_EMPTY_EXCEPTION, life: 3000});
                    return false;
                }
                if (typeof imageInfo.value.type == "undefined") {
                    toast.add({severity: 'error', summary: 'Error', detail: IMAGE_TYPE_EMPTY_EXCEPTION, life: 3000});
                    return false;
                }
                return true;
            }
            const save2imageInfos = () => {
                if (checkImageInfo()) {
                    imageInfos.value.push(imageInfo.value);
                    showImage();
                    imageInfo.value = {};
                }
            };
            const clearUploadedImage = () => {
                imageInfos.value = [];
                document.getElementById("imgBox").innerHTML = "";
            };
            const submitImages = () => {
                const formData = new FormData();
                for (const img of imageInfos.value) {
                    formData.append("images", img.image);
                }
                formData.append("id", album.value.id);
                formData.append("imageInfos", JSON.stringify(imageInfos.value));
                axiosRequest(INSERT_ALBUM_IMAGES_URL, formData)
                    .then(res => {
                        if (res.state === 1) {
                            closeImageEditDialog();
                            location.reload(true);
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    }).catch(err => {
                    console.error(err);
                });
            };
            //endregion

            //region ------页面header------
            const domainUrl = DOMAIN_URL;
            const selectedEntity = ref();
            const entityType = ref(ENTITY_TYPE);
            const notLoginNavbarItems = ref(NOT_LOGIN_NAVBAR_ITEMS);
            const loginNavbarItems = ref(LOGIN_NAVBAR_ITEMS);
            //endregion

            const init = () => {
                text2marked();
                initImageClass($("#galleria-item").attr("src"));
                album.value.publishFormat = album.value.publishFormat.join("/");
                album.value.mediaFormat = album.value.mediaFormat.join("/");
                album.value.albumFormat = album.value.albumFormat.join("/");
            };

            const initImageClass = (url) => {
                var image = new Image();
                image.src = url;
                image.onload = function () {
                    galleriaItemClass.value = (this.naturalWidth > this.naturalHeight) ? "galleria-div-width" : "galleria-div-height";
                }
            }

            return {
                clearUploadedImage,
                closeImageEditDialog,
                selectedImage,
                getImageTypeLabel,
                editingImages,
                imgRowEditSave,
                imgRowReorder,

                tmpEditDiscList,
                tmpArtists,

                cmDisc,
                selectedDisc,
                menuModelDisc,
                onRowReorderDisc,
                discRowMenu,
                editingRowsDisc,
                onRowEditSaveDisc,

                cmTrack,
                selectedTrack,
                menuModelTrack,
                onRowReorderTrack,
                trackRowMenu,
                editingRowsTrack,
                onRowEditSaveTrack,

                tracks,
                disc,
                addDisc,
                submitTrackInfo,
                onRowReorder,


                expandedRows, expandAll, collapseAll,

                cm,
                artist,
                artists,
                menuModel,
                editingRows,
                selectedArtist,
                addArtist,
                clearArtists,
                submitArtist,
                deleteArtist,
                cancelArtistEdit,
                artistRowMenu,
                onRowEditSave,

                initGalleriaImageClass,
                getSidebarPanelImageClass,
                imageClick,
                displayCustom,
                activeIndex,

                domainUrl, notLoginNavbarItems, loginNavbarItems, entityType, selectedEntity,
                edits,
                seriesBool,
                displayEditDialog,
                albumEdit,
                openEditDialog,
                closeEditDialog,

                submitEditAlbum,
                mediaFormatSet,
                albumFormatSet,
                publishFormatSet,
                productSet,

                seriesSet,
                visitNum,
                updateImage,
                cancelDeleteSelectedImage,
                deleteImage,
                confirmDeleteSelectedImage,
                deleteAlbumImageDialog,
                initImageClass,

                galleriaItemClass,
                onUpload,
                save2imageInfos,
                imageInfo,
                imageInfos,
                imageTypes,
                album,
                relatedAlbums,
                submitImages,
                selectFile,
                imageHtml,
                displayImageEditDialog,
                displayArtistEditDialog,
                displayTrackEditDialog,

                responsiveOptions,
                descriptionMd,
                displayDescriptionDialog,
                closeDescriptionEditDialog,
                submitDescription,
                bonusMd,
                displayBonusDialog,
                closeBonusEditDialog,
                submitBonus,
            }
        },
        components: {
            "p-panel": primevue.panel,
            "p-fieldset": primevue.fieldset,
            "p-button": primevue.button,
            "p-dialog": primevue.dialog,
            "p-fileupload": primevue.fileupload,
            "p-chips": primevue.chips,
            "p-divider": primevue.divider,
            "p-inputtext": primevue.inputtext,
            "p-multiselect": primevue.multiselect,
            "p-galleria": primevue.galleria,
            "p-menubar": primevue.menubar,
            "p-avatar": primevue.avatar,
            "p-toast": primevue.toast,
            "p-dropdown": primevue.dropdown,
            "p-textarea": primevue.textarea,
            "p-calendar": primevue.calendar,
            "p-inputnumber": primevue.inputnumber,
            "p-inputswitch": primevue.inputswitch,
            "p-splitbutton": primevue.splitbutton,
            "p-datatable": primevue.datatable,
            "p-column": primevue.column,
            "p-contextmenu": primevue.contextmenu,
            "p-inplace": primevue.inplace,
        }
    };

    const routes = [{path: "/", component: App}];

    const router = VueRouter.createRouter({
        // history: VueRouter.createWebHashHistory(),
        history: VueRouter.createWebHistory(),
        routes
    });

    createApp(App)
        .use(router)
        .use(primevue.toastservice)
        .use(primevue.config.default)
        .use(MdEditorV3)
        .directive('tooltip', Tooltip)
        .mount("#app");
</script>
<style>
    .image-cover {
        position: absolute;
        top: 50%;
        left: 50%;
        display: block;
        min-width: 100%;
        max-width: 100%;
        transform: translate(-50%, -50%);
        cursor: pointer;
        pointer-events: none;
    }

    .edit-image {
        pointer-events: none;
        width: 50px;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)
    }

    .orders-subtable {
        padding: 1rem;
    }

    .p-tooltip-text {
        width: 15rem;
    }

    .card {
        padding: 0rem;
    }

    .edit-image-div {
        position: relative;
        width: 240px;
        height: 240px;
        overflow: auto;
        background-color: black;
    }

    #edit-image-img {
        width: 200px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none;
    }

    #galleria-div {
        position: relative;
        width: 600px;
        height: 600px;
        overflow: hidden;
        background-color: black;
    }

    .galleria-thumb-image {
        display: block;
        /*height: 500px;*/
        /*width: 500px;*/
        max-width: 100px;
        max-height: 100px;
        height: auto;
        width: auto;
        /*overflow: auto;*/
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
    }

    /*.p-galleria .p-galleria-thumbnail-items-container {*/
    /*    width: 100%;*/
    /*}*/

    .p-galleria .p-galleria-item-wrapper {
        width: 600px;
        height: 600px;
    }

    .p-galleria .p-galleria-item-container {
        /*width: 500px;*/
        /*height: 500px;*/
    }

    .custom-galleria-footer {
        display: flex;
        align-items: center;
        /*background-color: rgba(0, 0, 0, 0.9);*/
        color: #ffffff;
    }

    .custom-galleria-footer > button {
        background-color: transparent;
        color: #ffffff;
        border: 0 none;
        border-radius: 0;
        margin: .2rem 0;
    }

    .custom-galleria-footer > button.fullscreen-button {
        margin-left: auto;
    }

    .custom-galleria-footer > button:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .title-container > span {
        font-size: .9rem;
        padding-left: .829rem;
    }

    .title-container > span.title {
        font-weight: bold;
    }

    .p-galleria-content {
        position: relative;
    }

    .p-galleria-item-wrapper {
        height: 500px;
        width: 500px;
    }

    .p-galleria-thumbnail-content {
        height: 100px;
        width: 100px;
    }

    #imgBox img {
        height: 200px;
    }

    .p-panel .p-panel-header {
        /* border: 1px solid #dee2e6; */
        padding: 0.5rem;
        background: #6d7c8b;
        color: #d0da9a;
        border-top-right-radius: 3px;
        border-top-left-radius: 3px;
    }

    .label {
        color: #788990;
    }

    b.rbot {
        background-position: 0 -8px;
    }

    .p-panel .p-panel-content {
        padding: 0.5rem;
    }
</style>
</body>
</html>
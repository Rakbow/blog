<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>Rakbow's Database</title>

    <!-- bootstrap -->
    <link rel="stylesheet" th:href="@{/css/bootstrap/myBootstrap.min.css}">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,700,700i,600,600i&amp;display=swap">
    <link rel="stylesheet" th:href="@{/assets/fonts/simple-line-icons.min.css}">
    <link rel="stylesheet" th:href="@{/css/ajax/libs/baguettebox.js/1.11.1/baguetteBox.min.css}">
    <link rel="stylesheet" th:href="@{/assets/css/styles.min.css}">

    <!-- other css -->
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <link rel="stylesheet" th:href="@{/css/iconfont/iconfont.css}">


    <link rel="shortcut icon" th:href="@{/img/favicon.ico}" type="image/x-icon">
    <script th:src="@{/assets/bootstrap/js/bootstrap.min.js}"></script>
    <script th:src="@{/js/ajax/libs/baguettebox.js/1.11.1/baguetteBox.min.js}"></script>
    <script th:src="@{/assets/js/script.min.js}"></script>

    <!-- PrimeVue -->
    <link th:href="@{/css/primevue/themes/saga-blue/theme.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/primevue/primevue.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/primeflex/primeflex.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/primeicons/primeicons.css}" rel="stylesheet" type="text/css"/>

    <!-- Dependencies -->
    <script th:src="@{/js/primevue/vue.min.js}"></script>
    <script th:src="@{/js/primevue/primevue.min.js}"></script>
    <script th:src="@{/js/primevue/vue-router.global.js}"></script>

    <!-- PrimeVue Components -->
    <script th:src="@{/js/primevue/components/fileupload.min.js}"></script>
    <script th:src="@{/js/primevue/components/panel.min.js}"></script>
    <script th:src="@{/js/primevue/components/divider.min.js}"></script>
    <script th:src="@{/js/primevue/components/chips.min.js}"></script>
    <script th:src="@{/js/primevue/components/dialog.min.js}"></script>
    <script th:src="@{/js/primevue/components/toolbar.min.js}"></script>
    <script th:src="@{/js/primevue/components/fieldset.min.js}"></script>
    <script th:src="@{/js/primevue/components/image.min.js}"></script>
    <script th:src="@{/js/primevue/components/card.min.js}"></script>
    <script th:src="@{/js/primevue/components/fieldset.min.js}"></script>
    <script th:src="@{/js/primevue/components/chips.min.js}"></script>
    <script th:src="@{/js/primevue/components/divider.min.js}"></script>
    <script th:src="@{/js/primevue/components/inputtext.min.js}"></script>
    <script th:src="@{/js/primevue/components/multiselect.min.js}"></script>
    <script th:src="@{/js/primevue/components/galleria.min.js}"></script>
    <script th:src="@{/js/primevue/components/menubar.min.js}"></script>
    <script th:src="@{/js/primevue/components/avatar.min.js}"></script>
    <script th:src="@{/js/primevue/components/toast.min.js}"></script>
    <script th:src="@{/js/primevue/components/toastservice.min.js}"></script>
    <script th:src="@{/js/primevue/components/textarea.min.js}"></script>

    <!-- Axios -->
    <script th:src="@{/js/axios/axios.min.js}"></script>

    <!-- other -->
    <script th:src="@{/js/basic/httpRequest.js}"></script>
    <script th:src="@{/js/basic/basicParam.js}"></script>
    <script th:src="@{/js/basic/dataHandler.js}"></script>
    <script th:src="@{/js/jquery/1.10.2/jquery.min.js}"></script>

    <!-- md-editor-v3 -->
    <script th:src="@{/js/md-editor-v3/2.2.1/md-editor-v3.umd.js}"></script>
    <link th:href="@{/css/md-editor-v3/2.2.1/style.css}" rel="stylesheet">

    <!-- marked -->
    <script th:src="@{/js/marked/marked.min.js}"></script>
    <link th:href="@{/css/markdown/github-markdown.css}" rel="stylesheet">


</head>
<body>
<div class="nk-container">
    <div class="main">
        <div class="container">
            <div id="app">

                <!-- 头部 -->
                <header class="sticky-top" th:insert="~{header :: site_header}"></header>
                <br><br>

                <p-toolbar>
                    <template #start>
                        <p-button label="编辑图片" icon="pi pi-images" class="p-button-rounded mr-2"
                                  @click="openImageEditDialog"></p-button>
                        <p-button label="编辑音乐制作" icon="pi pi-users" class="p-button-rounded mr-2"
                                  @click="openArtistEditDialog"></p-button>
                        <p-button label="编辑音轨信息" icon="pi iconfont icon-playlist" class="p-button-rounded mr-2"
                                  @click="openTrackEditDialog"></p-button>
                        <p-button label="编辑描述" icon="pi iconfont icon-miaoshu" class="p-button-rounded mr-2"
                                  @click="openDescriptionEditDialog"></p-button>
                        <p-button label="编辑特典" icon="pi iconfont icon-gift" class="p-button-rounded mr-2"
                                  @click="openBonusEditDialog"></p-button>
                    </template>
                    <template #end>
                    </template>
                </p-toolbar>
                <div class="grid card mt-2">
                    <p-toast></p-toast>
                    <div class="col-12 sm:col-12 md:col-6 lg:col-9">
                        <p-panel>
                            <template #header>
                                <i class="pi iconfont icon-24gl-musicAlbum2 mr-0" style="font-size: 2rem"></i>
                                <div class="container mt-0 mb-0 ml-0">
                                    <h4 class="text-start ml-2 mt-0 mb-0">{{album.nameJp}}</h4>
                                    <h4 class="text-start ml-2 mt-0 mb-0"><small>{{album.nameEn}}</small></h4>
                                </div>
                            </template>
                            <div class="grid">
                                <div class="ml-3" style="transform:translateY(20.7px);width: 250px; height: 250px">
                                    <img :src="album.cover.url" :alt="album.cover.name" id="coverart"/>
                                </div>
                                <table class="table-borderless table-sm ml-3">
                                    <tbody>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-dingdanbianhao mr-1"
                                               style="font-size: 1.3rem"></i>
                                            <strong>专辑编号</strong>
                                        </td>
                                        <td>
                                            {{album.catalogNo?album.catalogNo:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-bar-code mr-1" style="font-size: 1.3rem"></i>
                                            <strong>商品条形码</strong>
                                        </td>
                                        <td>{{album.barcode?album.barcode:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi pi-calendar mr-1" style="font-size: 1.3rem"></i>
                                            <strong>发行时间</strong>
                                        </td>
                                        <td>
                                            {{album.releaseDate?album.releaseDate:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-wuliaojiage mr-1" style="font-size: 1.3rem"></i>
                                            <strong>发行价格</strong>
                                        </td>
                                        <td>
                                            {{album.publishPrice?album.publishPrice:"N/A"}} 日元(含税)
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi pi-print mr-1" style="font-size: 1.3rem"></i>
                                            <strong>出版形式</strong>
                                        </td>
                                        <td>
                                            {{album.publishFormat?album.publishFormat:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-zhuanjiguangpan mr-1"
                                               style="font-size: 1.3rem"></i>
                                            <strong>媒体类型</strong>
                                        </td>
                                        <td>
                                            {{album.mediaFormat?album.mediaFormat:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-musicfill mr-1" style="font-size: 1.3rem"></i>
                                            <strong>专辑类型</strong>
                                        </td>
                                        <td>
                                            {{album.albumFormat?album.albumFormat:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-tushuyinxiang mr-1"
                                               style="font-size: 1.3rem"></i>
                                            <strong>唱片公司</strong>
                                        </td>
                                        <td>{{album.label?album.label:"N/A"}}</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-gongsi mr-1" style="font-size: 1.3rem"></i>
                                            <strong>出版商</strong>
                                        </td>
                                        <td>
                                            {{album.publisher?album.publisher:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-company mr-1" style="font-size: 1.3rem"></i>
                                            <strong>经销商</strong>
                                        </td>
                                        <td>
                                            {{album.distributor?album.distributor:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <i class="pi iconfont icon-copyright mr-1" style="font-size: 1.3rem"></i>
                                            <strong>版权方</strong>
                                        </td>
                                        <td>
                                            {{album.copyright?album.copyright:"N/A"}}
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </p-panel>
                        <p-fieldset :toggleable="true" class="mt-2">
                            <template #legend>
                                <i class="pi pi-users mr-2" style="font-size: 2rem"></i>
                                <b>音乐创作</b>
                            </template>
                            <div class="grid" v-if="album.artists.length != 0">
                                <table class="table-borderless table-sm ml-10">
                                    <tbody>
                                    <tr v-for="item in album.artists">
                                        <td><strong>{{item.position}}</strong></td>
                                        <td>
                                            {{item.artist.join("/")}}
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div v-else>
                                <span>暂无音乐创作相关信息</span>
                            </div>
                        </p-fieldset>
                        <p-fieldset :toggleable="true" class="mt-2">
                            <template #legend>
                                <i class="pi iconfont icon-playlist mr-2" style="font-size: 2rem"></i>
                                <b>音轨信息</b>
                            </template>
                            <div v-if="album.trackInfo == null || JSON.stringify(album.trackInfo) == '{}' ">
                                <span>暂无音轨信息</span>
                            </div>
                            <div v-else v-for="disc in album.trackInfo.disc_list">
                                <table class="table table-sm table-hover table-striped">
                                    <thead>
                                    <h5>
                                        Disc {{disc.serial}} ({{disc.media_format}})
                                        <span v-if="disc.catalog_no != ''">[{{disc.catalog_no}}]</span>
                                        {{disc.album_format}}
                                    </h5>
                                    </thead>
                                    <tbody>
                                    <tr v-for="track in disc.track_list">
                                        <th scope="row">{{track.serial}}</th>
                                        <td>{{track.name}}</td>
                                        <td class="text-end">{{track.length}}</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <p class="text-end">
                                    Disc length <b>{{disc.disc_length}}</b>
                                </p>
                            </div>
                            <div>
                                <p class="text-end"
                                   v-if="album.trackInfo != null && JSON.stringify(album.trackInfo) != '{}' ">
                                    Total tracks <b>{{album.trackInfo.total_tracks}}</b> Total length
                                    <b>{{album.trackInfo.total_length}}</b>
                                </p>
                            </div>
                        </p-fieldset>
                        <p-fieldset :toggleable="true" class="mt-2">
                            <template #legend>
                                <i class="pi iconfont icon-miaoshu mr-2" style="font-size: 2rem"></i>
                                <b>描述</b>
                            </template>
                            <article id="description" class="markdown-body" style="width: 100%;"></article>
                        </p-fieldset>
                        <p-fieldset :toggleable="true" class="mt-2">
                            <template #legend>
                                <i class="pi iconfont icon-gift mr-2" style="font-size: 2rem"></i>
                                <b>特典</b>
                            </template>
                            <article id="bonus" class="markdown-body" style="width: 100%;"></article>
                        </p-fieldset>
                        <p-fieldset :toggleable="true" class="mt-2">
                            <template #legend>
                                <i class="pi pi-images mr-2" style="font-size: 2rem"></i>
                                <b>图片</b>
                            </template>
                            <div v-if="album.displayImages.length == 0">
                                <span>暂无图片</span>
                            </div>
                            <div v-else align="center">
                                <p-galleria :value="album.displayImages" :responsive-options="responsiveOptions"
                                            :num-visible="5" container-style="width: 600px" :circular="true">
                                    <template #item="{item}">
                                        <div id="galleria-div">
                                            <img :class="galleriaItemClass" :src="item.url" :alt="item.name" />
                                        </div>
                                    </template>
                                    <template #caption="{item}">
                                        <div class="custom-galleria-footer">
                                            <span v-if="album.displayImages" class="title-container">
                                                <span>共{{album.displayImages.length}}张</span>
                                                <span class="title">{{item.nameZh}}</span>
                                                <span>{{item.description}}</span>
                                            </span>
                                        </div>
                                    </template>
                                    <template #thumbnail="{item}">
                                        <div class="grid grid-nogutter justify-content-center">
                                            <img id="galleria-item" :src="item.url" :alt="item.name" class="temp2"
                                                 @click="initImageClass(item.url)"/>
                                        </div>
                                    </template>
                                </p-galleria>
                            </div>
                        </p-fieldset>
                    </div>
                    <div class="col-12 sm:col-12 md:col-6 lg:col-3">
                        <p-panel>
                            <template #header>
                                <i class="pi iconfont icon-product_b mr-2" style="font-size: 2rem"></i>
                                <b>专辑分类</b>
                            </template>
                            <div class="grid">
                                <div class="col-fixed">
                                    <i class="pi pi-bookmark mr-2"></i><b>所属系列</b>
                                </div>
                                <div class="col-10 col-offset-1">
                                    {{album.series}}
                                </div>
                                <div class="col-fixed">
                                    <i class="pi pi-tags mr-2"></i><b>所属作品</b>
                                </div>
                                <div class="col-10 col-offset-1">
                                    <p class="mb-0" v-for="item of album.products">
                                        <a :href="'https://rakbow.com/blog/product/'+ item.id ">
                                            <span class="albumtitle" lang="en" style="display:inline">
                                                {{item.name}}
                                            </span>
                                        </a>
                                    </p>
                                </div>
                            </div>
                        </p-panel>
                        <br>
                        <p-panel>
                            <template #header>
                                <i class="pi iconfont icon-album mr-2" style="font-size: 2rem"></i>
                                <b>相关专辑</b>
                            </template>
                            <div class="grid">
                                <!-- <div style="width: 250px;"> -->
                                <span class="smallfont">
                                    <div class="album_infobit_small smallfont label" v-if="relatedAlbums.length != 0"
                                         v-for="relatedAlbum of relatedAlbums">
                                        <div class="album_infobit_thumb">
                                            <div :style="'background-image: url(' + relatedAlbum.images.url + ')'">
                                                <a :href="'http://localhost:8080/blog/album/'+ relatedAlbum.id "
                                                   :title="relatedAlbum.images.name"></a>
                                            </div>
                                        </div>
                                        <ul class="album_infobit_detail">
                                            <li>
                                                <a class="albumtitle smallfont album-anime"
                                                   :href="'http://localhost:8080/blog/album/'+ relatedAlbum.id ">
                                                    <span class="albumtitle" lang="en" style="display:inline">
                                                        {{relatedAlbum.nameJp}}
                                                    </span>
                                                </a>
                                            </li>
                                            <li>
                                                <span
                                                        class="catalog smallfont album-anime">{{relatedAlbum.catalogNo}}</span>
                                            </li>
                                            <li>{{relatedAlbum.relaseDate}}</li>
                                        </ul>
                                    </div>
                                </span>
                                <br>
                                <b class="rbot"><b></b></b>
                            </div>
                        </p-panel>
                        <br>
                        <p-panel>
                            <template #header>
                                <i class="pi pi-info-circle mr-2" style="font-size: 2rem"></i>
                                <b>页面信息</b>
                            </template>
                            <div class="grid">
                                <div class="col-fixed">
                                    <i class="pi pi-plus mr-2"></i><b>录入时间</b>
                                </div>
                                <div class="col-10 col-offset-1">
                                    {{album.addedTime}}
                                </div>
                                <div class="col-fixed">
                                    <i class="pi pi-pencil mr-2"></i><b>编辑时间</b>
                                </div>
                                <div class="col-10 col-offset-1">
                                    {{album.editedTime}}
                                </div>
                                <div class="col-fixed">
                                    <i class="pi pi-chart-bar mr-2"></i><b>页面流量</b>
                                </div>
                                <div class="col-10 col-offset-1">
                                    <i class="pi pi-eye mr-2"></i><b>访问数</b>1685
                                </div>
                            </div>
                        </p-panel>
                    </div>
                </div>
                <p-dialog v-model:visible="displayImageEditDialog" :style="{width: '800px'}" header="编辑图片"
                          :modal="true">
                    <p-panel>
                        <p-fileupload
                                mode="basic"
                                :custom-upload="true"
                                accept="image/*"
                                :auto="true"
                                choose-label="上传图片"
                                :max-file-size="1000000" :preview-width="100"
                                invalid-file-size-message="{0}大小已超过{1}"
                                @uploader="onUpload"
                                @select="selectFile">
                        </p-fileupload>
                        <div class="formgrid grid mt-2">
                            <div class="field col">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-image"></i>
                                    </span>
                                    <p-inputtext v-model="imageInfo.nameZh" placeholder="图片名(中)"></p-inputtext>
                                </div>
                            </div>
                            <div class="field col">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-image"></i>
                                    </span>
                                    <p-inputtext v-model="imageInfo.nameEn" placeholder="图片名(英)"></p-inputtext>
                                </div>
                            </div>
                        </div>
                        <div class="formgrid grid mt-2">
                            <div class="field col">
                                <p-dropdown v-model="imageInfo.type" :options="imageTypes" option-label="label"
                                            option-value="value" placeholder="选择图片类型"></p-dropdown>
                            </div>
                            <div class="field col">
                                <p-textarea v-model="imageInfo.description" rows="1" cols="20"
                                            :auto-resize="true" placeholder="图片描述"></p-textarea>
                            </div>
                            <div class="field col">
                                <p-button label="保存当前图片信息" icon="pi pi-save"
                                          @click="save2imageInfos"></p-button>
                            </div>
                            <div class="field col">
                                <p-button label="提交更新" icon="pi pi-save"
                                          @click="submitImages" class="p-button-success"></p-button>
                            </div>
                        </div>
                        <p-divider></p-divider>
                        <div class="field">
                            <span v-if=" imageHtml == '' ">还未选择图片</span>
                            <section>
                                <div id="imgBox" v-html="imageHtml"></div>
                            </section>
                        </div>
                    </p-panel>
                </p-dialog>
                <p-dialog v-model:visible="displayArtistEditDialog" :style="{width: '800px'}" header="编辑音乐制作"
                          :modal="true">
                    <!--                    <p-panel>-->
                    <div class="grid">
                        <div class="col-3">
                            <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-tag"></i>
                                    </span>
                                <p-inputtext v-model="positionName" placeholder="职位名称"></p-inputtext>
                            </div>
                        </div>
                        <div class="col-7">
                            <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-users"></i>
                                    </span>
                                <p-chips v-model="positionArtist" placeholder="人员信息" separator=","></p-chips>
                            </div>
                        </div>
                        <div class="col-2">
                            <p-button label="保存当前" icon="pi pi-save"
                                      @click="saveArtist"></p-button>
                        </div>
                    </div>
                    <p-divider></p-divider>
                    <div class="grid">
                        <section>
                            <div id="artistBox" v-html="artistHtml"></div>
                        </section>
                    </div>
                    <!--                    </p-panel>-->
                    <template #footer>
                        <p-button label="提交更新" icon="pi pi-save" class="p-button-success mr-4"
                                  @click="submitArtist"></p-button>
                    </template>
                </p-dialog>
                <p-dialog v-model:visible="displayTrackEditDialog" :style="{width: '800px'}" header="编辑音轨信息"
                          :modal="true">
                    <p-panel>
                        <div class="grid">
                            <div class="col-10">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-tag"></i>
                                    </span>
                                    <p-chips v-model="musicName" placeholder="曲目列表" separator=","></p-chips>
                                </div>
                            </div>
                            <div class="col-10">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-users"></i>
                                    </span>
                                    <p-chips v-model="musicLength" placeholder="曲目长度" separator=","></p-chips>
                                </div>
                            </div>

                            <div class="col-5">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-tag"></i>
                                    </span>
                                    <p-multiselect id="mediaFormat" v-model="mediaFormat" :options="mediaFormatSet"
                                                   option-label="label" option-value="labelEn" placeholder="媒体格式"
                                                   display="chip">
                                    </p-multiselect>
                                </div>
                            </div>
                            <div class="col-5">
                                <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-tag"></i>
                                    </span>
                                    <p-multiselect id="albumFormat" v-model="albumFormat" :options="albumFormatSet"
                                                   option-label="label" option-value="labelEn" placeholder="专辑分类"
                                                   display="chip">
                                    </p-multiselect>
                                </div>
                            </div>

                            <div class="col-2">
                                <p-button label="保存disc" icon="pi pi-save" class="p-button-success"
                                          @click="saveDisc"></p-button>
                            </div>
                        </div>
                        <p-divider></p-divider>
                        <div class="grid">
                            <section>
                                <div id="trackBox" v-html="trackHtml"></div>
                            </section>
                        </div>
                    </p-panel>
                    <template #footer>
                        <p-button label="保存" icon="pi pi-save" class="p-button-success mr-4"
                                  @click="submitTrackInfo"></p-button>
                    </template>
                </p-dialog>
                <p-dialog v-model:visible="displayDescriptionDialog" header="编辑描述信息"
                          :breakpoints="{'960px': '75vw', '640px': '90vw'}" :style="{width: '80vw'}" :modal="true">
                    <!--                    <div id="md-editor-v3">-->
                    <md-editor-v3 v-model="descriptionMd" preview-theme="github">
                    </md-editor-v3>
                    <!--                    </div>-->
                    <template #footer>
                        <p-button label="cancel" icon="pi pi-times" @click="closeDescriptionEditDialog"
                                  class="p-button-text">
                        </p-button>
                        <p-button label="save" icon="pi pi-save" @click="submitDescription" autofocus></p-button>
                    </template>
                </p-dialog>
                <p-dialog v-model:visible="displayBonusDialog" header="编辑特典信息"
                          :breakpoints="{'960px': '75vw', '640px': '90vw'}" :style="{width: '80vw'}" :modal="true">
                    <!--                    <div id="md-editor-v3">-->
                    <md-editor-v3 v-model="bonusMd" preview-theme="github"></md-editor-v3>
                    <!--                    </div>-->
                    <template #footer>
                        <p-button label="cancel" icon="pi pi-times" @click="closeBonusEditDialog" class="p-button-text">
                        </p-button>
                        <p-button label="save" icon="pi pi-save" @click="submitBonus" autofocus></p-button>
                    </template>
                </p-dialog>
            </div>
        </div>
    </div>

    <!-- 尾部 -->
    <!--    <footer th:insert="~{footer :: site_footer}"></footer>-->
</div>
<script type="module" th:inline="javascript">

    const {createApp, onMounted, ref} = Vue;
    const {useToast} = primevue.usetoast;

    const App = {
        setup() {
            onMounted(() => {
                init();
            })

            const album = ref([[${album}]]);

            const toast = useToast();

            const mediaFormatSet = ref([[${mediaFormatSet}]]);
            const albumFormatSet = ref([[${albumFormatSet}]]);

            //region ------图片展示------
            const galleriaItemClass = ref("");
            const responsiveOptions = [
                {
                    breakpoint: '1024px',
                    numVisible: 5
                },
                {
                    breakpoint: '768px',
                    numVisible: 3
                },
                {
                    breakpoint: '560px',
                    numVisible: 1
                }
            ];

            //编辑描述
            const descriptionMd = ref("");
            const displayDescriptionDialog = ref(false);
            const openDescriptionEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state == 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            descriptionMd.value = album.value.description;
                            displayDescriptionDialog.value = true;
                        }
                    });
            }
            const closeDescriptionEditDialog = () => {
                displayDescriptionDialog.value = false;
                descriptionMd.value = "";
            }
            const submitDescription = () => {
                let json = {
                    id: album.value.id,
                    description: descriptionMd.value
                }
                axiosPostRequest(UPDATE_ALBUM_DESCRIPTION_URL, json)
                    .then(res => {
                        if (res.state != 0) {
                            album.value.description = descriptionMd.value;
                            text2marked();
                            closeDescriptionEditDialog();
                            toast.add({severity: 'success', summary: 'Successful', detail: res.message, life: 3000});
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    });
            }

            //编辑特典
            const bonusMd = ref("");
            const displayBonusDialog = ref(false);
            const openBonusEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state == 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            bonusMd.value = album.value.bonus;
                            displayBonusDialog.value = true;
                        }
                    });
            }
            const closeBonusEditDialog = () => {
                displayBonusDialog.value = false;
                bonusMd.value = "";
            }
            const submitBonus = () => {
                let json = {
                    id: album.value.id,
                    bonus: bonusMd.value
                }
                axiosPostRequest(UPDATE_ALBUM_BONUS_URL, json)
                    .then(res => {
                        if (res.state != 0) {
                            album.value.bonus = bonusMd.value;
                            text2marked();
                            closeBonusEditDialog();
                            toast.add({severity: 'success', summary: 'Successful', detail: res.message, life: 3000});
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    });
            }

            const text2marked = () => {

                const description = album.value.description;
                const bonus = album.value.bonus;

                if (description != null && description != "") {
                    var view = marked.parse(description);
                    document.getElementById("description").innerHTML = view;
                } else {
                    document.getElementById("description").innerHTML = "暂无描述信息";
                }

                if (bonus != null && bonus != "") {
                    var view = marked.parse(bonus);
                    document.getElementById("bonus").innerHTML = view;
                } else {
                    document.getElementById("bonus").innerHTML = "暂无特典信息";
                }
            };

            //音轨信息相关组件
            const mediaFormat = ref();
            const albumFormat = ref();
            const trackHtml = ref("");
            const musicName = ref([]);
            const musicLength = ref([]);
            const discList = ref([]);
            const displayTrackEditDialog = ref(false);
            const openTrackEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state == 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            discList.value = [];
                            trackHtml.value = "";
                            displayTrackEditDialog.value = true;
                        }
                    });
            };
            const saveDisc = () => {
                let disc = {track_list: null, media_format: null, album_format: null};
                let trackList = [];
                for (let i = 0; i < musicName.value.length; i++) {
                    let param = {name: null, length: null};
                    param.name = musicName.value[i];
                    param.length = musicLength.value[i];
                    trackList.push(param);
                }
                disc.track_list = trackList;
                disc.album_format = albumFormat.value.join(",");
                disc.media_format = mediaFormat.value.join(",");
                discList.value.push(disc);
                musicName.value = [];
                musicLength.value = [];
                albumFormat.value = "";
                mediaFormat.value = "";
                showTrackInfo();
            };
            const showTrackInfo = () => {
                trackHtml.value = "";
                //<![CDATA[
                for (const disc of discList.value) {
                    for (let t of disc.track_list) {
                        trackHtml.value += '<p>' + t.name + ' : ' + t.length + '</p>';
                    }
                }
                //]]>
                document.getElementById("trackBox").innerHTML = trackHtml;
            };
            const submitTrackInfo = () => {
                let json = {
                    id: album.value.id,
                    discList: discList.value
                }
                axiosPostRequest(UPDATE_ALBUM_TRACK_INFO_URL, json)
                    .then(res => {
                        if (res.state != 0) {
                            toast.add({severity: 'success', summary: 'Successful', detail: res.message, life: 3000});
                            displayTrackEditDialog.value = false;
                            discList.value = [];
                            location.reload(true);
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    })
            };

            //artists相关组件
            const artistHtml = ref("");
            const positionName = ref();
            const positionArtist = ref();
            const artists = ref([]);
            const displayArtistEditDialog = ref(false);
            const openArtistEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state == 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            artists.value = [];
                            positionName.value = "";
                            positionArtist.value = "";
                            displayArtistEditDialog.value = true;
                        }
                    })
            };
            const saveArtist = () => {
                let param = {
                    position: positionName.value,
                    artist: positionArtist.value
                };
                artists.value.push(param);
                positionName.value = "";
                positionArtist.value = [];
                showArtist();
            }
            const showArtist = () => {
                artistHtml.value = "";
                //<![CDATA[
                for (const a of artists.value) {
                    artistHtml.value += '<p>' + a.position + ' : ' + a.artist.join("/") + '</p>';
                }
                //]]>
                document.getElementById("artistBox").innerHTML = artistHtml;
            };
            const submitArtist = () => {
                let json = {
                    id: album.value.id,
                    artists: artists.value
                }
                axiosPostRequest(UPDATE_ALBUM_ARTISTS_URL, json)
                    .then(res => {
                        if (res.state == 1) {
                            toast.add({severity: 'success', summary: 'Successful', detail: res.message, life: 3000});
                            displayArtistEditDialog.value = false;
                            artists.value = [];
                            location.reload(true);
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    })
            };

            //图片相关组件
            const imageTypes = ref([
                {label: '展示', value: '0'},
                {label: '封面', value: '1'},
                {label: '其他', value: '2'}
            ]);
            const imageInfo = ref({
                image: null,
                nameZh: null,
                nameEn: null,
                description: null,
                type: null
            });
            const imageInfos = ref([]);
            const imgCover = ref({});
            const relatedAlbums = ref([[${relatedAlbums}]]);
            const displayImageEditDialog = ref(false);
            const imageHtml = ref("");
            const openImageEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state == 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            imageInfo.value = {};
                            imageInfos.value = [];
                            displayImageEditDialog.value = true;
                        }
                    })
            };
            const closeImageEditDialog = () => {
                imageInfo.value = {};
                imageInfos.value = [];
                displayImageEditDialog.value = false;
            };
            const showImage = () => {
                imageHtml.value = "";
                //<![CDATA[
                for (const img of imageInfos.value) {
                    imageHtml.value += '<div align=""center>';
                    imageHtml.value += '<img src="' + img.image.objectURL + '"/>';
                    imageHtml.value += '<p>图片类型: ' + img.type + '</p>';
                    imageHtml.value += '<p>图片名(中): ' + img.nameZh + '</p>';
                    imageHtml.value += '<p>图片名(英): ' + img.nameEn + '</p>';
                    imageHtml.value += '<p>描述: ' + img.description + '</p>';
                    imageHtml.value += '</div>';
                }
                //]]>
                document.getElementById("imgBox").innerHTML = imageHtml;
            };
            const selectFile = (ev) => {
                imageInfo.value.image = ev.files[0];
            };
            const onUpload = (ev) => {
                toast.add({severity: 'info', summary: 'Success', detail: '图片已经选择', life: 3000});
            };
            const save2imageInfos = () => {
                imageInfos.value.push(imageInfo.value);
                showImage();
                imageInfo.value = {};
            };
            const submitImages = () => {
                const formData = new FormData();
                for (const img of imageInfos.value) {
                    formData.append("images", img.image);
                }
                formData.append("id", album.value.id);
                formData.append("imageInfos", JSON.stringify(imageInfos.value));
                axiosRequest(UPDATE_ALBUM_IMAGES_URL, formData)
                    .then(res => {
                        if (res.state == 1) {
                            closeImageEditDialog();
                            location.reload(true);
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    }).catch(err => {
                    console.log(err);
                });
            };

            const navbarItems = ref([
                {
                    label: 'Home',
                    icon: 'pi pi-fw pi-home',
                    url: "http://localhost:8080"
                },
                {
                    label: 'DataBase',
                    icon: 'pi pi-fw iconfont icon-database',
                    url: "http://localhost:8080/db"
                },
                {
                    label: 'Album',
                    icon: 'pi pi-fw iconfont icon-24gl-musicAlbum2',
                    items: [
                        {
                            label: 'Album List',
                            icon: 'pi pi-fw pi-list',
                            url: 'http://localhost:8080/db/album/list'
                        },
                        {
                            label: 'Album Card',
                            icon: 'pi pi-fw pi-list',
                            // url: 'http://localhost:8080/db/album/card'
                        }
                    ]
                },
                {
                    label: 'Disc',
                    icon: 'pi pi-fw iconfont icon-Video-Disc',
                    items: [
                        {
                            label: 'Develop',
                            icon: 'pi pi-fw pi-wrench'
                        },
                        {
                            label: 'Develop',
                            icon: 'pi pi-fw pi-wrench'
                        }
                    ]
                },
                {
                    label: 'Book',
                    icon: 'pi pi-fw pi-book',
                    items: [
                        {
                            label: 'Book List',
                            icon: 'pi pi-fw pi-book'
                        },
                        {
                            label: 'Develop',
                            icon: 'pi pi-fw pi-wrench'
                        }
                    ]
                }
            ]);

            const init = () => {
                text2marked();
                initImageClass($("#galleria-item").attr("src"));
                album.value.publishFormat = album.value.publishFormat.join("/");
                album.value.mediaFormat = album.value.mediaFormat.join("/");
                album.value.albumFormat = album.value.albumFormat.join("/");
            };

            const initImageClass = (url) => {
                var image = new Image();
                image.src = url;
                image.onload = function () {
                    galleriaItemClass.value = (this.naturalWidth > this.naturalHeight) ? "galleria-div-width" : "galleria-div-height";
                }
            }

            return {
                initImageClass,
                galleriaItemClass,
                // showThumbnails,
                // fullScreen,
                // onThumbnailButtonClick,
                // toggleFullScreen,
                // galleriaClass,
                // fullScreenIcon,


                onUpload,
                save2imageInfos,
                imageInfo,
                imageInfos,
                imageTypes,
                album,
                relatedAlbums,
                imgCover,
                submitImages,
                selectFile,
                imageHtml,
                displayImageEditDialog,
                openImageEditDialog,
                positionName,
                positionArtist,
                openArtistEditDialog,
                displayArtistEditDialog,
                artists,
                saveArtist,
                artistHtml,
                submitArtist,
                openTrackEditDialog,
                displayTrackEditDialog,
                musicName,
                musicLength,
                discList,
                saveDisc,
                trackHtml,
                submitTrackInfo,
                mediaFormatSet,
                albumFormatSet,
                mediaFormat,
                albumFormat,
                responsiveOptions,
                navbarItems,
                descriptionMd,
                displayDescriptionDialog,
                openDescriptionEditDialog,
                closeDescriptionEditDialog,
                submitDescription,
                bonusMd,
                displayBonusDialog,
                openBonusEditDialog,
                closeBonusEditDialog,
                submitBonus,
            }
        },
        components: {
            "p-panel": primevue.panel,
            "p-image": primevue.image,
            "p-fieldset": primevue.fieldset,
            "p-button": primevue.button,
            "p-dialog": primevue.dialog,
            "p-fileupload": primevue.fileupload,
            "p-toolbar": primevue.toolbar,
            "p-chips": primevue.chips,
            "p-divider": primevue.divider,
            "p-inputtext": primevue.inputtext,
            "p-multiselect": primevue.multiselect,
            "p-galleria": primevue.galleria,
            "p-menubar": primevue.menubar,
            "p-avatar": primevue.avatar,
            "p-toast": primevue.toast,
            "p-dropdown": primevue.dropdown,
            "p-textarea": primevue.textarea,
        }
    };

    const routes = [{path: "/", component: App}];

    const router = VueRouter.createRouter({
        history: VueRouter.createWebHashHistory(),
        routes
    });

    createApp(App)
        .use(router)
        .use(primevue.toastservice)
        .use(primevue.config.default)
        .use(MdEditorV3)
        .mount("#app");
</script>

<style>

    #galleria-div {
        position: relative;
        width: 600px;
        height: 600px;
        overflow: hidden;
        background-color: black;
    }

    .galleria-div-width {
        position: absolute;
        top: 50%;
        left: 50%;
        display: block;
        min-width: 100%;
        max-width: 100%;
        transform: translate(-50%, -50%);
        pointer-events: none;
    }

    .galleria-div-height {
        position: absolute;
        top: 50%;
        left: 50%;
        display: block;
        min-height: 100%;
        max-height: 100%;
        transform: translate(-50%, -50%);
        pointer-events: none;
    }

    .temp2 {
        display: block;
        /*height: 500px;*/
        /*width: 500px;*/
        max-width: 100px;
        max-height: 100px;
        height: auto;
        width: auto;
        /*overflow: auto;*/
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
    }

    /*.p-galleria .p-galleria-thumbnail-items-container {*/
    /*    width: 100%;*/
    /*}*/

    .p-galleria .p-galleria-item-wrapper {
        width: 600px;
        height: 600px;
    }

    .p-galleria .p-galleria-item-container {
        /*width: 500px;*/
        /*height: 500px;*/
    }

    .custom-galleria-footer {
        display: flex;
        align-items: center;
        /*background-color: rgba(0, 0, 0, 0.9);*/
        color: #ffffff;
    }

    .custom-galleria-footer > button {
        background-color: transparent;
        color: #ffffff;
        border: 0 none;
        border-radius: 0;
        margin: .2rem 0;
    }

    .custom-galleria-footer > button.fullscreen-button {
        margin-left: auto;
    }

    .custom-galleria-footer > button:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .title-container > span {
        font-size: .9rem;
        padding-left: .829rem;
    }

    .title-container > span.title {
        font-weight: bold;
    }

    .p-galleria-content {
        position: relative;
    }

    /*.p-galleria-thumbnail-wrapper {*/
    /*    position: absolute;*/
    /*    bottom: 0;*/
    /*    left: 0;*/
    /*    width: 100%;*/
    /*}*/

    /*.p-galleria-thumbnail-items-container {*/
    /*    width: 100%;*/
    /*}*/

    /*.custom-galleria-footer {*/
    /*    display: flex;*/
    /*    align-items: center;*/
    /*    background-color: rgba(0, 0, 0, .9);*/
    /*    color: #ffffff;*/
    /*}*/

    /*.custom-galleria-footer .p-button {*/
    /*    background-color: transparent;*/
    /*    color: #ffffff;*/
    /*    border: 0 none;*/
    /*    border-radius: 0;*/
    /*    margin: .2rem 0;*/
    /*}*/


    .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        /* max-width: 980px; */
        margin: 0 auto;
        padding: 10px;
    }

    @media (max-width: 767px) {
        .markdown-body {
            padding: 15px;
        }
    }

    #md-area {
        width: 100%;
        background: #f5f5f5;
        border: 1px solid #111;
    }

    #view-area {
        width: 100%;
        /* border: 1px solid #111; */
    }

    .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        /* max-width: 980px; */
        margin: 0 auto;
        padding: 10px;
    }

    @media (max-width: 767px) {
        .markdown-body {
            padding: 15px;
        }
    }

    .p-galleria-item-wrapper {
        height: 500px;
        width: 500px;
    }

    .p-galleria-thumbnail-content {
        height: 100px;
        width: 100px;
    }

    #imgBox img {
        height: 200px;
    }

    .p-panel .p-panel-header {
        /* border: 1px solid #dee2e6; */
        padding: 0.5rem;
        background: #6d7c8b;
        color: #d0da9a;
        border-top-right-radius: 3px;
        border-top-left-radius: 3px;
    }

    #coverart {
        max-width: 100%;
        max-height: 100%;
        position: relative;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none;
    }

    .album_infobit_small {
        clear: left;
        height: 76px;
        /* border-top: 1px solid #464A64; */
        /* border-bottom: 1px solid #1B273D; */
        padding: 4px 6px 4px 4px;
        overflow: hidden;
    }

    .label {
        color: #788990;
    }

    .album_infobit_thumb {
        float: left;
        margin: 0 4px 0 0;
        padding: 8px;
        /*background: transparent url(https://vgmdb.net/db/img/border_thumb.png) 0 0 no-repeat;*/
    }

    ul.album_infobit_detail {
        list-style-type: none;
        margin: 6px 0 0 0;
        padding: 0;
        overflow: hidden;
    }

    b.rbot {
        background-position: 0 -8px;
    }

    .smallfont {
        font: 11px verdana, geneva, lucida, 'lucida grande', arial, helvetica, Meiryo, sans-serif;
    }

    a.album-anime {
        /* color: yellowgreen !important; */
    }

    /* #imgRelatedAlbum {
        width: 50px;
    } */

    .p-panel .p-panel-content {
        padding: 0.5rem;
    }

    /*
    p-image {
        width: 250px;
        margin-right: 0 auto;
    } */
</style>
</body>
</html>
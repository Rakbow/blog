<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>登录</title>

  <link rel="shortcut icon" th:href="@{/img/favicon.ico}" type="image/x-icon">
  <!-- PrimeVue -->
  <link th:href="@{/css/primevue/themes/saga-blue/theme.css}" rel="stylesheet" type="text/css"/>
  <link th:href="@{/css/primevue/primevue.min.css}" rel="stylesheet" type="text/css"/>
  <link th:href="@{/css/primeflex/primeflex.min.css}" rel="stylesheet" type="text/css"/>
  <link th:href="@{/css/primeicons/primeicons.css}" rel="stylesheet" type="text/css"/>

  <!-- Dependencies -->
  <script th:src="@{/js/primevue/vue.min.js}" type="text/javascript"></script>
  <script th:src="@{/js/primevue/primevue.min.js}" type="text/javascript"></script>

  <!-- PrimeVue Components -->
  <script th:src="@{/js/primevue/components/dialog.min.js}"></script>
  <script th:src="@{/js/primevue/components/inputtext.min.js}"></script>
  <script th:src="@{/js/primevue/components/password.min.js}"></script>
  <script th:src="@{/js/primevue/components/checkbox.min.js}"></script>
  <script th:src="@{/js/primevue/components/toast.min.js}"></script>
  <script th:src="@{/js/primevue/components/toastservice.min.js}"></script>

  <!-- Axios -->
  <script th:src="@{/js/axios/axios.min.js}"></script>
  <script th:src="@{/js/basic/httpRequest.js}"></script>
  <script th:src="@{/js/basic/basicParam.js}"></script>

  <!-- JQuery -->
  <script th:src="@{/js/jquery/1.10.2/jquery.min.js}"></script>
</head>
<body>
<!-- 头部 -->
<!--	<header th:insert="~{header :: site_header}"></header>-->
<div id="app">
  <div class="form-demo">
    <p-toast></p-toast>
    <div class="flex justify-content-center">
      <div class="card">
        <h5 class="text-center">登 录</h5>
        <form class="p-fluid">
          <div class="field">
            <div class="p-float-label">
              <p-inputtext id="name" v-model="param.username"></p-inputtext>
              <label htmlFor="name">用户名<span style="color: red">*</span></label>
            </div>
          </div>
          <div class="field">
            <div class="p-float-label">
              <p-password id="password" v-model="param.password"
                          :feedback="false"></p-password>
              <label htmlFor="password">密码<span style="color: red">*</span></label>
            </div>
          </div>
          <div class="formgrid grid">
            <div class="field col">
              <div class="p-float-label">
                <p-inputtext id="verifyCode" v-model="param.verifyCode"></p-inputtext>
                <label htmlFor="verifyCode">验证码<span style="color: red">*</span></label>
              </div>
            </div>
            <div class="field col">
              <img th:src="@{/kaptcha}" id="kaptcha" style="width:100px;height:40px;"
                   class="mr-2"/>
            </div>
            <div class="field col">
              <p-button @click="refreshKaptcha" label="刷新验证码"
                        class="p-button-link"></p-button>
            </div>
          </div>
          <div class="field-checkbox">
            <p-checkbox inputId="binary" v-model="param.rememberMe" :binary="true"></p-checkbox>
            <label htmlFor="binary">记住我</label>
          </div>
          <p-button label="登录" class="mt-2" @click="login"></p-button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- 尾部 -->
<!--	<footer th:insert="~{footer :: site_footer}"></footer>-->

<script type="module" th:inline="javascript">
  const {createApp, onMounted, ref} = Vue;
  const {FilterMatchMode, FilterOperator} = primevue.api;
  const Tooltip = primevue.tooltip;
  const {useToast} = primevue.usetoast;
  const App = {
    setup() {
      onMounted(() => {
      });

      const param = ref({
        username: "",
        password: "",
        verifyCode: "",
        rememberMe: false,
      });
      const toast = useToast();

      //提交登陆信息
      const login = () => {
        axiosPostRequest(LOGIN_URL, param.value)
                .then(res => {
                  if (res.state == 0) {
                    toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                  }else {
                    window.location.href = "http://localhost:8080";
                  }
                }).catch(err => {
          console.log(err);
        });
      }

      //刷新验证码
      const refreshKaptcha = () => {
        const path = DOMIAN_URL + "/kaptcha?p=" + Math.random();
        $("#kaptcha").attr("src", path);
      }

      return {param, refreshKaptcha, login}
    },
    components: {
      "p-button": primevue.button,
      "p-dialog": primevue.dialog,
      "p-inputtext": primevue.inputtext,
      "p-password": primevue.password,
      "p-toast": primevue.toast,
      "p-checkbox": primevue.checkbox,
    }
  };

  const app = createApp(App);
  app.use(primevue.config.default);
  app.directive('tooltip', Tooltip);
  app.use(primevue.toastservice);
  app.mount("#app");
</script>
</body>
<style>
  .card {
    min-width: 500px;
  }

  form {
    margin-top: 2rem;
  }

  .field {
    margin-bottom: 1.5rem;
  }

  @media screen and (max-width: 960px) {
    .card {
      width: 80%;
    }
  }
</style>
</html>

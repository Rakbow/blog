<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Music Detail</title>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>

    <!-- bootstrap -->
    <link rel="stylesheet" th:href="@{/css/bootstrap/myBootstrap.min.css}">
    <script src="https://cdn.staticfile.org/bootstrap/5.2.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.staticfile.org/baguettebox.js/1.11.1/baguetteBox.min.js"></script>
    <link href="https://cdn.staticfile.org/baguettebox.js/1.11.1/baguetteBox.min.css" rel="stylesheet">

    <!--other css -->
    <link th:href="@{/img/favicon.ico}" type="image/x-icon" rel="shortcut icon"/>
    <link th:href="@{/css/index.css}" rel="stylesheet"/>
    <link th:href="@{/css/iconfont/iconfont.css}" rel="stylesheet" type="text/css"/>

    <!-- PrimeVue -->
    <link th:href="@{/css/primevue/themes/saga-blue/theme.css}" rel="stylesheet"/>
    <link th:href="@{/css/primevue/primevue.min.css}" rel="stylesheet"/>
    <link th:href="@{/css/primeflex/primeflex.min.css}" rel="stylesheet"/>
    <link th:href="@{/css/primeicons/primeicons.css}" rel="stylesheet"/>

    <!-- Vue3 -->
    <script src="https://cdn.staticfile.org/vue/3.2.41/vue.global.js"></script>
    <script th:src="@{/js/primevue/primevue.min.js}"></script>
    <script src="https://cdn.staticfile.org/vue-router/4.1.6/vue-router.global.js"></script>

    <!-- PrimeVue Components -->
    <script th:src="@{/js/primevue/components/fileupload.min.js}"></script>
    <script th:src="@{/js/primevue/components/panel.min.js}"></script>
    <script th:src="@{/js/primevue/components/divider.min.js}"></script>
    <script th:src="@{/js/primevue/components/chips.min.js}"></script>
    <script th:src="@{/js/primevue/components/dialog.min.js}"></script>
    <script th:src="@{/js/primevue/components/toolbar.min.js}"></script>
    <script th:src="@{/js/primevue/components/fieldset.min.js}"></script>
    <script th:src="@{/js/primevue/components/image.min.js}"></script>
    <script th:src="@{/js/primevue/components/card.min.js}"></script>
    <script th:src="@{/js/primevue/components/fieldset.min.js}"></script>
    <script th:src="@{/js/primevue/components/chips.min.js}"></script>
    <script th:src="@{/js/primevue/components/inputtext.min.js}"></script>
    <script th:src="@{/js/primevue/components/multiselect.min.js}"></script>
    <script th:src="@{/js/primevue/components/galleria.min.js}"></script>
    <script th:src="@{/js/primevue/components/menubar.min.js}"></script>
    <script th:src="@{/js/primevue/components/avatar.min.js}"></script>
    <script th:src="@{/js/primevue/components/toast.min.js}"></script>
    <script th:src="@{/js/primevue/components/toastservice.min.js}"></script>
    <script th:src="@{/js/primevue/components/textarea.min.js}"></script>
    <script th:src="@{/js/primevue/components/calendar.min.js}"></script>
    <script th:src="@{/js/primevue/components/inputnumber.min.js}"></script>
    <script th:src="@{/js/primevue/components/inputswitch.min.js}"></script>
    <script th:src="@{/js/primevue/components/splitbutton.min.js}"></script>
    <script th:src="@{/js/primevue/components/tag.min.js}"></script>

    <!-- Axios -->
    <script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>

    <!-- Jquery -->
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>

    <!-- high light js -->
    <link href="https://cdn.staticfile.org/highlight.js/11.6.0/styles/default.min.css" rel="stylesheet">
    <script src="https://cdn.staticfile.org/highlight.js/11.6.0/highlight.min.js"></script>

    <!-- md-editor-v3 -->
    <script th:src="@{/js/md-editor-v3/2.2.1/md-editor-v3.umd.js}"></script>
    <link th:href="@{/css/md-editor-v3/2.2.1/style.css}" rel="stylesheet">

    <!-- marked -->
    <script src="https://cdn.staticfile.org/marked/4.2.0/marked.min.js"></script>
    <link href="https://cdn.staticfile.org/github-markdown-css/5.1.0/github-markdown.css" rel="stylesheet">

    <!-- aPlayer -->
    <link href="https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.css" rel="stylesheet">
    <script src="https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.js"></script>

    <!-- basic js -->
    <script th:src="@{/js/basic/Data_Helper.js}"></script>
    <script th:src="@{/js/basic/Http_Request.js}"></script>
    <script th:src="@{/js/basic/Rakbow_Web_Helper_Str.js}"></script>
    <script th:src="@{/js/basic/Rakbow_Web_Exception_Str_CN.js}"></script>
</head>
<body>
<div class="nk-container">
    <div class="main">
        <div class="container">
            <div id="app">
                <!-- 头部 -->
                <header class="sticky-top mb-2" th:insert="~{header :: site_header}"></header>

                <div class="grid card mt-2">
                    <p-toast></p-toast>
                    <div class="col-12 sm:col-12 md:col-6 lg:col-9">
                        <p-panel>
                            <template #header>
                                <i class="pi iconfont icon-music mr-0" style="font-size: 2rem"></i>
                                <div class="container mt-0 mb-0 ml-0">
                                    <h4 class="text-start ml-2 mt-0 mb-0" style="text-align: left">{{music.name}}</h4>
                                    <h4 class="text-start ml-2 mt-0 mb-0" style="text-align: left"><small>{{music.nameEn}}</small>
                                    </h4>
                                </div>
                            </template>
                            <template #icons th:if="${loginUser != null}">
                                <p-splitbutton :model="edits" class="p-button-rounded bg-primary mb-2"
                                               th:if="${loginUser.type == 1}">
                                    <p-button @click="openEditDialog">
                                        <i class="pi pi-pencil"></i>
                                        <span class="ml-2 flex align-items-center font-bold">编辑</span>
                                    </p-button>
                                </p-splitbutton>
                            </template>
                            <div class="grid">
                                <div class="ml-3" style="width: 200px; height: 200px">
                                    <img :src="music.coverUrl" alt="cover" id="coverart"/>
                                </div>
                                <table class="table-borderless table-sm ml-3">
                                    <tbody>
                                    <tr>
                                        <td><strong>曲目(日语)</strong></td>
                                        <td>
                                            {{music.name?music.name:"N/A"}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>曲目(英语)</strong></td>
                                        <td>
                                            {{music.nameEn?music.nameEn:" - "}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>音频长度</strong></td>
                                        <td>
                                            {{music.audioLength}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>音频类型</strong></td>
                                        <td>
                                            {{music.audioTypeObj.name}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>碟片序号</strong></td>
                                        <td>
                                            {{music.discSerial}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>曲目序号</strong></td>
                                        <td>
                                            {{music.trackSerial}}
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </p-panel>
                        <p-fieldset :toggleable="true" class="mt-2">
                            <template #legend>
                                <i class="pi pi-users mr-2" style="font-size: 2rem"></i>
                                <b>音乐创作</b>
                            </template>
                            <div class="grid" v-if="music.artists.length != 0">
                                <table class="table-borderless table-sm ml-10">
                                    <tbody>
                                    <tr v-for="artist in music.artists">
                                        <td><strong>{{artist.pos}}</strong></td>
                                        <td>
                                            {{artist.name.join("/")}}
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div v-else>
                                <span class="emptyInfo"><em>暂无音乐创作相关信息</em></span>
                            </div>
                        </p-fieldset>
                        <p-fieldset :toggleable="true" class="mt-2">
                            <template #legend>
                                <i class="pi iconfont icon-miaoshu mr-2" style="font-size: 2rem"></i>
                                <b>描述</b>
                            </template>
                            <article id="description" class="markdown-body" style="width: 100%;"></article>
                        </p-fieldset>
                        <p-fieldset :toggleable="true" class="mt-2">
                            <template #legend>
                                <i class="pi iconfont icon-music mr-2" style="font-size: 2rem"></i>
                                <b>歌词</b>
                            </template>
                            <article id="lyrics" class="markdown-body" style="width: 100%;"></article>
                        </p-fieldset>
                    </div>
                    <div class="col-12 sm:col-12 md:col-6 lg:col-3">
                        <p-panel>
                            <template #header>
                                <i class="pi pi-th-large mr-2" style="font-size: 2rem"></i>
                                <b>相关信息</b>
                            </template>
                            <span class="grid">
                                <span class="smallfont">
                                    <p-divider align="center">
                                        <i class="pi iconfont icon-24gl-musicAlbum2 mr-1" style="font-size: 1.5rem"></i>
                                        <span><b>所属专辑</b></span>
                                    </p-divider>
                                    <div class="music_infobit_small smallfont ml-2 mt-2 mb-2 grid" style="border: solid black">
                                        <div class="col-3 small-image-div mt-2">
                                        <a :href="'/db/album/'+ relatedAlbum.id ">
                                            <img class="small-image-img" :src="relatedAlbum.cover.url"
                                                 style="border-radius: 20%;">
                                        </a>
                                    </div>
                                        <div class="col-9">
                                        <ul class="album_infobit_detail">
                                            <li>
                                                <a class="smallfont"
                                                   :href="'/db/album/'+ relatedAlbum.id ">
                                                        <span class="text-truncate-2" lang="ja">
                                                            {{relatedAlbum.nameJp}}
                                                        </span>
                                                </a>
                                            </li>
                                            <li>
                                                    <span class="smallfont">
                                                        <b>{{relatedAlbum.catalogNo}}</b> {{relatedAlbum.releaseDate}}
                                                    </span>
                                            </li>

                                        </ul>
                                    </div>
                                    </div>
                                    <span class="ml-2">所属该专辑的第<b>{{music.discSerial}}</b>
                                        张碟片，第<b>{{music.trackSerial}}</b>首曲目</span>
                                    <p-divider align="center">
                                        <i class="pi iconfont icon-music mr-1" style="font-size: 1.5rem"></i>
                                        <span><b>相关曲目</b></span>
                                    </p-divider>
                                    <div class="music_infobit_small smallfont ml-0 grid"
                                         v-if="relatedMusics.length != 0"
                                         v-for="relatedMusic of relatedMusics">
                                        <div class="col-3 small-image-div mt-2">
                                            <a :href="'/db/music/'+ relatedMusic.id ">
                                                <img class="small-image-img" :src="relatedMusic.coverUrl"
                                                     style="border-radius: 20%;">
                                            </a>
                                        </div>
                                        <div class="col-9">
                                            <ul class="album_infobit_detail">
                                            <li>
                                                <a class="smallfont"
                                                   :href="'/db/music/'+ relatedMusic.id ">
                                                    <span class="text-truncate-2" lang="ja">
                                                        {{relatedMusic.name}}
                                                    </span>
                                                </a>
                                            </li>
                                            <li>
                                                <span class="smallfont">
                                                    <b>{{relatedMusic.audioLength}}</b>
                                                </span>
                                            </li>

                                        </ul>
                                        </div>
                                    </div>
                                </span>
                                <br>
                                <b class="rbot"><b></b></b>
                            </span>
                        </p-panel>
                        <br>
                        <p-panel>
                            <template #header>
                                <i class="pi pi-info-circle mr-2" style="font-size: 2rem"></i>
                                <b>页面信息</b>
                            </template>
                            <div class="grid">
                                <div class="col-fixed">
                                    <i class="pi pi-plus mr-2"></i><b>录入时间</b>
                                </div>
                                <div class="col-10 col-offset-1">
                                    {{music.addedTime}}
                                </div>
                                <div class="col-fixed">
                                    <i class="pi pi-pencil mr-2"></i><b>编辑时间</b>
                                </div>
                                <div class="col-10 col-offset-1">
                                    {{music.editedTime}}
                                </div>
                                <div class="col-fixed">
                                    <i class="pi pi-chart-bar mr-2"></i><b>页面流量</b>
                                </div>
                                <div class="col-10 col-offset-1">
                                    <i class="pi pi-eye mr-2"></i><b>访问数：</b>
                                    <span class="text-center">{{visitNum}}</span>
                                </div>
                            </div>
                        </p-panel>
                    </div>
                </div>
                <p-dialog v-model:visible="displayEditDialog" :style="{width: '500px'}" header="编辑基础信息" :modal="true"
                          class="p-fluid">
                    <div class="formgrid grid">
                        <div class="field col">
                            <label htmlFor="name">曲名<span style="color: red">*</span></label>
                            <p-inputtext id="name" v-model.trim="musicEdit.name"></p-inputtext>
                        </div>
                        <div class="field col">
                            <label htmlFor="nameEn">曲名(英语)</label>
                            <p-inputtext id="nameEn" v-model.trim="musicEdit.nameEn"></p-inputtext>
                        </div>
                    </div>
                    <div class="formgrid grid">
                        <div class="field col">
                            <label htmlFor="catalogNo">音频类型<span style="color: red">*</span></label>
                            <p-dropdown id="audioType" v-model="musicEdit.audioType" :options="audioTypeSet"
                                        option-label="label" option-value="value">
                            </p-dropdown>
                        </div>
                        <div class="field col">
                            <label htmlFor="audioLength">音频长度<span style="color: red">*</span></label>
                            <p-inputtext id="audioLength" v-model.trim="musicEdit.audioLength" placeholder="00:00"></p-inputtext>
                        </div>
                    </div>
                    <div class="formgrid grid">
                        <div class="field col">
                            <label htmlFor="discSerial">碟片序号<span style="color: red">*</span></label>
                            <p-inputnumber id="discSerial" v-model="musicEdit.discSerial" disabled="true"></p-inputnumber>
                        </div>
                        <div class="field col">
                            <label htmlFor="trackSerial">曲目序号<span style="color: red">*</span></label>
                            <p-inputtext id="trackSerial" v-model="musicEdit.trackSerial" disabled="true"></p-inputtext>
                        </div>
                    </div>
                    <div class="field">
                        <label htmlFor="audioUrl">音频链接</label>
                        <p-inputtext id="audioUrl" v-model.trim="musicEdit.audioUrl"></p-inputtext>
                    </div>
                    <div class="field">
                        <label htmlFor="coverUrl">封面链接</label>
                        <p-inputtext id="coverUrl" v-model.trim="musicEdit.coverUrl"></p-inputtext>
                    </div>
                    <div class="field">
                        <label htmlFor="lrcUrl">歌词文件链接(lrc)</label>
                        <p-inputtext id="lrcUrl" v-model.trim="musicEdit.lrcUrl"></p-inputtext>
                    </div>
                    <div class="field">
                        <label htmlFor="remark">备注</label>
                        <p-textarea id="remark" v-model.trim="musicEdit.remark" rows="3" cols="20"
                                    :auto-resize="true"></p-textarea>
                    </div>
                    <template #footer>
                        <p-button label="取消" icon="pi pi-times" class="p-button-text"
                                  @click="closeEditDialog"></p-button>
                        <p-button label="保存" icon="pi pi-check" class="p-button-text"
                                  @click="submitEditMusic"></p-button>
                    </template>
                </p-dialog>
                <p-dialog v-model:visible="displayArtistEditDialog" :style="{width: '800px'}" header="编辑创作"
                          :modal="true">
                    <div class="grid">
                        <div class="col-3">
                            <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-tag"></i>
                                    </span>
                                <p-inputtext v-model="artistPos" placeholder="职位名称"></p-inputtext>
                            </div>
                        </div>
                        <div class="col-7">
                            <div class="p-inputgroup">
                                    <span class="p-inputgroup-addon">
                                        <i class="pi pi-users"></i>
                                    </span>
                                <p-chips v-model="artistName" placeholder="人员信息" separator=","></p-chips>
                            </div>
                        </div>
                        <div class="col-2">
                            <p-button label="保存当前" icon="pi pi-save"
                                      @click="saveArtists"></p-button>
                        </div>
                    </div>
                    <p-divider></p-divider>
                    <div class="grid">
                        <section>
                            <div id="artistBox" v-html="artistHtml"></div>
                        </section>
                    </div>
                    <template #footer>
                        <p-button label="提交更新" icon="pi pi-save" class="p-button-success mr-4"
                                  @click="submitArtist"></p-button>
                    </template>
                </p-dialog>
                <!-- 尾部 -->
                <footer class="mt-2" th:insert="~{footer :: site_footer}"></footer>
            </div>
        </div>
    </div>
</div>
<script type="module" th:inline="javascript">

    const {createApp, onMounted, ref} = Vue;
    const Tooltip = primevue.tooltip;
    const {useToast} = primevue.usetoast;

    const App = {
        setup() {
            onMounted(() => {
                init();
            })

            //region 页面header
            const domainUrl = DOMAIN_URL;

            const selectedEntity = ref();

            const entityType = ref(ENTITY_TYPE);

            const notLoginNavbarItems = ref(NOT_LOGIN_NAVBAR_ITEMS);

            const loginNavbarItems = ref(LOGIN_NAVBAR_ITEMS);
            //endregion

            const music = ref([[${music}]]);

            const visitNum = ref([[${visitNum}]]);

            const relatedAlbum = ref([[${relatedAlbum}]]);

            const toast = useToast();

            const audioTypeSet = ref([[${audioTypeSet}]]);

            const relatedMusics = ref([[${relatedMusics}]]);

            const edits = ref([
                {
                    label: '音乐制作',
                    icon: 'pi pi-users',
                    command: () => {
                        openArtistEditDialog();
                    }
                },
                {
                    label: '描述信息',
                    icon: 'pi iconfont icon-miaoshu',
                    command: () => {
                        openDescriptionEditDialog();
                    }
                },
                {
                    label: '编辑歌词',
                    icon: 'pi iconfont icon-music',
                    command: () => {
                        openLyricsEditDialog();
                    }
                }
            ]);

            //region ------编辑music信息------
            const musicEdit = ref({});
            const displayEditDialog = ref(false);

            //打开编辑数据面板
            const openEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state === 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            let dataTmp = JSON.parse(JSON.stringify(music.value));
                            musicEdit.value = dataTmp;
                            displayEditDialog.value = true;
                        }
                    })
            };

            //关闭编辑基础信息面板
            const closeEditDialog = () => {
                displayEditDialog.value = false;
                musicEdit.value = {};
            };

            //保存编辑好的基础信息
            const submitEditMusic = () => {
                axiosPostRequest(UPDATE_MUSIC_URL, musicEdit.value)
                    .then(res => {
                        if (res.state === 1) {
                            musicEdit.value = {};
                            toast.add({
                                severity: 'success',
                                summary: 'Successful',
                                detail: res.message,
                                life: 3000
                            });
                            closeEditDialog();
                            location.reload(true);
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    })
                    .catch(error => {
                        console.error(error);
                    });
            };

            //region ------artists相关组件------
            const artistHtml = ref("");
            const artistPos = ref();
            const artistName = ref();
            const artists = ref([]);
            const displayArtistEditDialog = ref(false);
            const openArtistEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state === 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            artists.value = [];
                            artistPos.value = "";
                            artistName.value = [];
                            displayArtistEditDialog.value = true;
                        }
                    })
            };
            const saveArtists = () => {
                let artist = {
                    pos: artistPos.value,
                    name: artistName.value
                };
                artists.value.push(artist);
                artistPos.value = "";
                artistName.value = [];
                showArtist();
            }
            const showArtist = () => {
                artistHtml.value = "";
                //<![CDATA[
                for (const artist of artists.value) {
                    artistHtml.value += '<p>' + artist.pos + ' : ' + artist.name.join("/") + '</p>';
                }
                //]]>
                document.getElementById("artistBox").innerHTML = artistHtml;
            };
            const submitArtist = () => {
                let json = {
                    id: music.value.id,
                    artists: artists.value
                }
                axiosPostRequest(UPDATE_MUSIC_ARTISTS_URL, json)
                    .then(res => {
                        if (res.state === 1) {
                            toast.add({severity: 'success', summary: 'Successful', detail: res.message, life: 3000});
                            displayArtistEditDialog.value = false;
                            artists.value = [];
                            location.reload(true);
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    })
            };
            //endregion

            //region ------编辑描述------
            const descriptionMd = ref("");
            const displayDescriptionDialog = ref(false);
            const openDescriptionEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state == 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            descriptionMd.value = album.value.description;
                            displayDescriptionDialog.value = true;
                        }
                    });
            }
            const closeDescriptionEditDialog = () => {
                displayDescriptionDialog.value = false;
                descriptionMd.value = "";
            }
            const submitDescription = () => {
                let json = {
                    id: album.value.id,
                    description: descriptionMd.value
                }
                axiosPostRequest(UPDATE_ALBUM_DESCRIPTION_URL, json)
                    .then(res => {
                        if (res.state != 0) {
                            album.value.description = descriptionMd.value;
                            text2marked();
                            closeDescriptionEditDialog();
                            toast.add({severity: 'success', summary: 'Successful', detail: res.message, life: 3000});
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    });
            }
            //endregion

            //region ------编辑歌词------
            const lyricsMd = ref("");
            const displayLyricsDialog = ref(false);
            const openLyricsEditDialog = () => {
                axiosGetRequest(CHECK_USER_AUTHORITY_URL, null)
                    .then(res => {
                        if (res.state == 0) {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        } else {
                            lyricsMd.value = music.value.lrcText;
                            displayLyricsDialog.value = true;
                        }
                    });
            }
            const closeLyricsEditDialog = () => {
                displayLyricsDialog.value = false;
                lyricsMd.value = "";
            }
            const submitLyrics = () => {
                let json = {
                    id: music.value.id,
                    lyrics: lyricsMd.value
                }
                axiosPostRequest(UPDATE_MUSIC_LYRICS_TEXT_URL, json)
                    .then(res => {
                        if (res.state != 0) {
                            music.value.lrcText = lyricsMd.value;
                            text2marked();
                            closeLyricsEditDialog();
                            toast.add({severity: 'success', summary: 'Successful', detail: res.message, life: 3000});
                        } else {
                            toast.add({severity: 'error', summary: 'Error', detail: res.message, life: 3000});
                        }
                    });
            };
            //endregion

            //region ------markdown共通------

            const text2marked = () => {

                const description = music.value.description;
                const lyrics = music.value.lrcText;

                if (description != null && description !== "") {
                    document.getElementById("description").innerHTML = marked.parse(description);
                } else {
                    //<![CDATA[
                    document.getElementById("description").innerHTML = "<span class='emptyInfo'><em>暂无描述</em></span>";
                    //]]>
                }

                if (lyrics != null && lyrics !== "") {
                    document.getElementById("lyrics").innerHTML = marked.parse(lyrics);
                } else {
                    //<![CDATA[
                    document.getElementById("lyrics").innerHTML = "<span class='emptyInfo'><em>暂无歌词</em></span>";
                    //]]>
                }
            };
            //endregion

            const init = () => {
                text2marked();
            };

            return {
                relatedAlbum,
                domainUrl, notLoginNavbarItems, loginNavbarItems, entityType, selectedEntity,

                edits,
                relatedMusics,

                displayEditDialog,
                musicEdit,
                openEditDialog,
                closeEditDialog,
                submitEditMusic,

                audioTypeSet,

                visitNum,
                music,

                artistPos,
                artistName,
                displayArtistEditDialog,
                artists,
                saveArtists,
                artistHtml,
                submitArtist,
                descriptionMd,
                displayDescriptionDialog,
                closeDescriptionEditDialog,
                submitDescription,
                lyricsMd,
                displayLyricsDialog,
                closeLyricsEditDialog,
                submitLyrics,
            }
        },
        components: {
            "p-panel": primevue.panel,
            "p-image": primevue.image,
            "p-fieldset": primevue.fieldset,
            "p-button": primevue.button,
            "p-dialog": primevue.dialog,
            "p-fileupload": primevue.fileupload,
            "p-toolbar": primevue.toolbar,
            "p-chips": primevue.chips,
            "p-divider": primevue.divider,
            "p-inputtext": primevue.inputtext,
            "p-multiselect": primevue.multiselect,
            "p-galleria": primevue.galleria,
            "p-menubar": primevue.menubar,
            "p-avatar": primevue.avatar,
            "p-toast": primevue.toast,
            "p-dropdown": primevue.dropdown,
            "p-textarea": primevue.textarea,
            "p-calendar": primevue.calendar,
            "p-inputnumber": primevue.inputnumber,
            "p-inputswitch": primevue.inputswitch,
            "p-splitbutton": primevue.splitbutton,
            "p-tag": primevue.tag,
        }
    };

    const routes = [{path: "/", component: App}];

    const router = VueRouter.createRouter({
        // history: VueRouter.createWebHashHistory(),
        history: VueRouter.createWebHistory(),
        routes
    });

    createApp(App)
        .use(router)
        .use(primevue.toastservice)
        .use(primevue.config.default)
        .use(MdEditorV3)
        .directive('tooltip', Tooltip)
        .mount("#app");
</script>
<style>
    #panel-image-div {
        display: flex;
        position: relative;
        width: 100px;
        height: 100px;
        overflow: hidden;
        background-color: black;
        border: 1px solid black;
    }

    .panel-image-width {
        position: absolute;
        top: 50%;
        left: 50%;
        display: block;
        min-width: 100%;
        max-width: 100%;
        transform: translate(-50%, -50%);
        cursor: pointer;
        /*pointer-events: none;*/
    }

    .panel-image-height {
        position: absolute;
        top: 50%;
        left: 50%;
        display: block;
        min-height: 100%;
        max-height: 100%;
        transform: translate(-50%, -50%);
        cursor: pointer;
        /*pointer-events: none;*/
    }

    .small-image-img {
        width: 50px;
        position: relative;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    .small-image-div {
        position: relative;
        width: 60px;
        height: 60px;
    }

    .p-tooltip-text {
        width: 15rem;
    }

    .card {
        padding: 0rem;
    }

    .related-image-div {
        position: relative;
        width: 60px;
        height: 60px;
    }

    #related-image-img {
        width: 50px;
        position: relative;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    .edit-image-div {
        position: relative;
        width: 240px;
        height: 240px;
        overflow: auto;
        background-color: black;
    }

    #edit-image-img {
        width: 200px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none;
    }

    #galleria-div {
        position: relative;
        width: 600px;
        height: 600px;
        overflow: hidden;
        background-color: black;
    }

    .galleria-div-width {
        position: absolute;
        top: 50%;
        left: 50%;
        display: block;
        min-width: 100%;
        max-width: 100%;
        transform: translate(-50%, -50%);
        pointer-events: none;
    }

    .galleria-div-height {
        position: absolute;
        top: 50%;
        left: 50%;
        display: block;
        min-height: 100%;
        max-height: 100%;
        transform: translate(-50%, -50%);
        pointer-events: none;
    }

    .temp2 {
        display: block;
        /*height: 500px;*/
        /*width: 500px;*/
        max-width: 100px;
        max-height: 100px;
        height: auto;
        width: auto;
        /*overflow: auto;*/
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
    }

    /*.p-galleria .p-galleria-thumbnail-items-container {*/
    /*    width: 100%;*/
    /*}*/

    .p-galleria .p-galleria-item-wrapper {
        width: 600px;
        height: 600px;
    }

    .p-galleria .p-galleria-item-container {
        /*width: 500px;*/
        /*height: 500px;*/
    }

    .custom-galleria-footer {
        display: flex;
        align-items: center;
        /*background-color: rgba(0, 0, 0, 0.9);*/
        color: #ffffff;
    }

    .custom-galleria-footer > button {
        background-color: transparent;
        color: #ffffff;
        border: 0 none;
        border-radius: 0;
        margin: .2rem 0;
    }

    .custom-galleria-footer > button.fullscreen-button {
        margin-left: auto;
    }

    .custom-galleria-footer > button:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .title-container > span {
        font-size: .9rem;
        padding-left: .829rem;
    }

    .title-container > span.title {
        font-weight: bold;
    }

    .p-galleria-content {
        position: relative;
    }

    /*.p-galleria-thumbnail-wrapper {*/
    /*    position: absolute;*/
    /*    bottom: 0;*/
    /*    left: 0;*/
    /*    width: 100%;*/
    /*}*/

    /*.p-galleria-thumbnail-items-container {*/
    /*    width: 100%;*/
    /*}*/

    /*.custom-galleria-footer {*/
    /*    display: flex;*/
    /*    align-items: center;*/
    /*    background-color: rgba(0, 0, 0, .9);*/
    /*    color: #ffffff;*/
    /*}*/

    /*.custom-galleria-footer .p-button {*/
    /*    background-color: transparent;*/
    /*    color: #ffffff;*/
    /*    border: 0 none;*/
    /*    border-radius: 0;*/
    /*    margin: .2rem 0;*/
    /*}*/


    .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        /* max-width: 980px; */
        margin: 0 auto;
        padding: 10px;
    }

    @media (max-width: 767px) {
        .markdown-body {
            padding: 15px;
        }
    }

    #md-area {
        width: 100%;
        background: #f5f5f5;
        border: 1px solid #111;
    }

    #view-area {
        width: 100%;
        /* border: 1px solid #111; */
    }

    .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        /* max-width: 980px; */
        margin: 0 auto;
        padding: 10px;
    }

    @media (max-width: 767px) {
        .markdown-body {
            padding: 15px;
        }
    }

    .p-galleria-item-wrapper {
        height: 500px;
        width: 500px;
    }

    .p-galleria-thumbnail-content {
        height: 100px;
        width: 100px;
    }

    #imgBox img {
        height: 200px;
    }

    .p-panel .p-panel-header {
        /* border: 1px solid #dee2e6; */
        padding: 0.5rem;
        background: #6d7c8b;
        color: #d0da9a;
        border-top-right-radius: 3px;
        border-top-left-radius: 3px;
    }

    #coverart {
        max-width: 100%;
        max-height: 100%;
        position: relative;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none;
    }

    .music_infobit_small {
        clear: left;
        height: 76px;
        padding: 4px 6px 4px 4px;
        overflow: hidden;
    }

    .label {
        color: #788990;
    }

    .music_infobit_thumb {
        float: left;
        margin: 0 4px 0 0;
        padding: 8px;
    }

    ul.music_infobit_detail {
        list-style-type: none;
        margin: 6px 0 0 0;
        padding: 0;
        overflow: hidden;
    }

    b.rbot {
        background-position: 0 -8px;
    }

    .smallfont {
        font: 11px verdana, geneva, lucida, 'lucida grande', arial, helvetica, Meiryo, sans-serif;
    }

    .p-panel .p-panel-content {
        padding: 0.5rem;
    }
</style>
</body>
</html>